
<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <link rel="shortcut icon" type="image/x-icon" href="https://diycode.b0.upaiyun.com/assets/favicon-bd135558698197f509ada06695c03a4f458f0077fa476f9a4e7ba9664f3dc55f.ico" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
  <meta name="apple-mobile-web-app-capable" content="no">
  <meta content='True' name='HandheldFriendly' />
  <meta http-equiv="X-Frame-Options" content="ALLOW-FROM https://www.bilibili.com">  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    简单又不简单的 Bool - Swift 标准库源码导读 (二) － 小专栏
  </title>
  <meta name="keywords" content="" />
  <meta name="description" content="开发笔记簿 - @onevcat - 在上一篇文章中，我们搭建了 Swift 标准库的开发环境。从这篇文章开始，我们来尝试读读看 Swift 标准库中的一些..." />
  <link rel="stylesheet" media="screen" href="https://diycode.b0.upaiyun.com/assets/application-b98c26c20e7776e123c2c1bc36da9e706c8e4c9831e43f7fcfc7d421d0485d87.css" />
  <link rel="stylesheet" media="screen" href="https://diycode.b0.upaiyun.com/assets/base-aace1a658937e9f384af9188054fa7fdff9ca76cca8cacb076ea492b1bd5fab2.css" />
  <script src="https://diycode.b0.upaiyun.com/assets/application-bbcab3605916afca4dffc9db4f4720181da4dc097647111c6b6d326042f60372.js"></script>
  <script src="https://diycode.b0.upaiyun.com/assets/lib/showdown_toc-ebb63501ea44121d364fd5bbf368e6680552896b0b1250218e5bfcd6c6e75fac.js"></script>
  <script src="https://diycode.b0.upaiyun.com/assets/lib/flowchart-e67c581916393cef0114623cdb6386ae4d590f549b3a4fe6d4a5b65930200f67.js"></script>
  <script src="https://diycode.b0.upaiyun.com/assets/lib/mermaid-87c4a8b71bd9cec95ceb3601f3c343505dcd851ccf412682982e9d530887eaca.js"></script>


  <meta name="action-cable-url" content="/cable" />
    <script src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_SVG"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]], displayMath: [ ['$$','$$'], ["\\[","\\]"] ], processEscapes: true }, TeX: { equationNumbers: { autoNumber: "AMS" } }, messageStyle: "none", SVG: { blacker: 1 }});
    </script>
    <link rel="dns-prefetch" href="//cdn.bootcss.com" />
    <link rel="dns-prefetch" href="//cdn.mathjax.org" />
    <script src="https://diycode.b0.upaiyun.com/assets/lib/raphael-73fc121fcba5dc93ab67fbe3a44329411937f2f432ec705a3e2c337ad2d4d576.js"></script>
</head>
<body data-current-user-id="47622" class="  "  >
  <script type="text/javascript">
    $(window).unbind('scroll');
  </script>

  <div class="xzl-site-main" id="container" data-page-title="简单又不简单的 Bool - Swift 标准库源码导读 (二) － 小专栏" data-page-description="在上一篇文章中，我们搭建了 Swift 标准库的...">
    <img class="share_page_img hidden" src="https://diycode.b0.upaiyun.com/photo/2018/f5e14921eaf8bf786d8f6d7a36e4e9a1.png!small" alt="F5e14921eaf8bf786d8f6d7a36e4e9a1" />
    <div class="xzl-main-container">
        <div class="xzl-metabar-wrapper ">
          <div class="metabar">
            <a href="/", class="xzl-logo-link">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="129px" height="58px" viewBox="0 0 129 58" version="1.1" class="xzl-logo">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title></title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="&#20999;&#22270;" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-472.000000, -200.000000)" id="icon_top_logo">
            <g transform="translate(472.000000, 200.000000)">
                <g id="Group-41">
                    <g id="Group-2">
                        <g id="Page-1">
                            <path d="M23.9123901,41.7443802 C23.9123901,41.7443802 19.2192543,44.5151723 16.162242,44.5817861 C13.9866123,44.6294495 12.0035012,43.6474693 11.0397728,43.0760832 C10.7206123,42.8877267 10.6746123,42.4415287 10.9432296,42.1848356 L32.4956494,21.521905 C32.4956494,21.521905 34.056242,25.6910139 32.8937481,27.4488158 C31.7312543,29.2066178 29.5391556,29.7768554 29.5391556,29.7768554 C29.5391556,29.7768554 41.5860444,39.8912515 45.492637,57.2493307 L25.4917235,57.4382614 C25.4917235,57.4382614 29.5914025,42.3186376 23.9123901,41.7443802" id="Fill-1" fill="#2F302F"></path>
                            <path d="M27.7058,2.0516495 C27.142442,1.64048119 26.4212074,2.3026 26.7727383,2.90901584 C27.2849852,3.79279802 27.8040469,4.76731287 28.0578988,5.48054059 C30.5657506,10.5443426 30.4215037,17.7524218 27.2912321,23.4858079 C25.1678494,27.3752535 22.0148617,29.9272535 18.6398247,30.4871545 C17.7862691,30.628996 15.5362444,30.6634515 13.7377012,30.0202832 C11.8488617,29.3443822 10.4217259,27.9851149 10.0696272,27.9529564 C9.23651605,27.8754317 10.191158,29.3392139 10.3814049,29.5155109 C12.3701951,31.3548574 14.774121,32.3230554 17.2831086,32.3230554 C17.8237506,32.3230554 18.3689358,32.2782634 18.9158247,32.1875307 C22.8087877,31.5409168 26.4053062,28.672501 28.7825407,24.3184812 C32.6084914,17.3113921 32.2972815,8.21285743 28.3657012,2.65289703 C28.2379235,2.4725802 27.9977012,2.26412475 27.7058,2.0516495" id="Fill-3" fill="#2F302F"></path>
                            <path d="M22.537558,29.4592337 C20.036521,29.4592337 17.5956815,28.1384416 15.9345704,26.4323228 C15.6046198,26.0935109 16.0720025,25.8184416 16.4922494,26.0320653 C18.6786691,27.1415307 22.1962494,28.5473129 24.8449407,27.1817287 C25.263484,26.9658079 25.7768667,27.1334911 25.9909654,27.5578673 C26.2044963,27.9816693 26.0381012,28.500798 25.6189901,28.7167188 C24.6155086,29.2335505 23.5711383,29.4592337 22.537558,29.4592337" id="Fill-5" fill="#2F302F"></path>
                            <path d="M37.4898864,3.49935248 C39.8273679,2.31925347 42.7049235,3.35291683 42.7049235,3.35291683 C42.7049235,3.35291683 41.7923062,6.29943168 39.4548247,7.47953069 C37.1167753,8.6596297 34.2392198,7.62596634 34.2392198,7.62596634 C34.2392198,7.62596634 35.1524049,4.67945149 37.4898864,3.49935248" id="Fill-7" fill="#E96D4E"></path>
                            <path d="M35.1822765,15.2556079 C37.2448938,14.8105584 39.2876346,16.2048554 39.2876346,16.2048554 C39.2876346,16.2048554 37.9865728,18.3209941 35.9239556,18.7666178 C33.8613383,19.2122416 31.8180296,17.8173703 31.8180296,17.8173703 C31.8180296,17.8173703 33.1190914,15.7006574 35.1822765,15.2556079" id="Fill-9" fill="#E96D4E"></path>
                            <path d="M31.2196889,3.02237426 C31.1146272,1.4018198 32.3787753,5.74257426e-05 32.3787753,5.74257426e-05 C32.3787753,5.74257426e-05 33.8127259,1.22494851 33.9177877,2.84550297 C34.0222815,4.46605743 32.7581333,5.8678198 32.7581333,5.8678198 C32.7581333,5.8678198 31.3241827,4.64292871 31.2196889,3.02237426" id="Fill-11" fill="#E96D4E"></path>
                            <path d="M20.8261309,14.3684376 C19.0633654,14.3954277 17.6123778,12.9167149 17.6123778,12.9167149 C17.6123778,12.9167149 19.0207728,11.3943584 20.7835383,11.3673683 C22.5468716,11.3403782 23.9972914,12.8190911 23.9972914,12.8190911 C23.9972914,12.8190911 22.5888963,14.3414475 20.8261309,14.3684376" id="Fill-13" fill="#E96D4E"></path>
                            <path d="M4.78099012,32.1154614 C2.47417531,32.837303 0.000397530864,31.4441545 0.000397530864,31.4441545 C0.000397530864,31.4441545 1.26624938,28.8818178 3.5730642,28.1599762 C5.87987901,27.4387089 8.35422469,28.8312832 8.35422469,28.8312832 C8.35422469,28.8312832 7.08780494,31.3941941 4.78099012,32.1154614" id="Fill-15" fill="#E96D4E"></path>
                            <path d="M8.88685926,26.3325168 C7.2041679,25.8380812 6.25520494,23.9952891 6.25520494,23.9952891 C6.25520494,23.9952891 8.03443951,22.9541604 9.71656296,23.448596 C11.3992543,23.9424574 12.3482173,25.7858238 12.3482173,25.7858238 C12.3482173,25.7858238 10.5689827,26.8269525 8.88685926,26.3325168" id="Fill-17" fill="#E96D4E"></path>
                            <path d="M14.0892321,21.7925525 C14.0625407,19.7240772 15.7741951,18.0248495 15.7741951,18.0248495 C15.7741951,18.0248495 17.5301457,19.6792851 17.556837,21.7471861 C17.5840963,23.8156614 15.8718741,25.5148891 15.8718741,25.5148891 C15.8718741,25.5148891 14.1159235,23.8610277 14.0892321,21.7925525" id="Fill-19" fill="#E96D4E"></path>
                            <path d="M24.5324247,5.05444158 C26.4462519,6.85244158 26.4996346,9.93907525 26.4996346,9.93907525 C26.4996346,9.93907525 23.4505728,10.1107782 21.5367457,8.31277822 C19.6229185,6.51477822 19.5695358,3.42814455 19.5695358,3.42814455 C19.5695358,3.42814455 22.6185975,3.25644158 24.5324247,5.05444158" id="Fill-21" fill="#E96D4E"></path>
                            <path d="M30.2585728,10.221897 C31.5732642,9.29504554 32.6948691,7.38678812 33.4365481,6.26124356 C33.6307704,5.96492673 34.0845235,6.1946297 33.9686716,6.52999604 C33.3224,8.39633267 32.1911407,10.8369267 30.4522272,11.9693624" id="Fill-23" fill="#2F302F"></path>
                            <path d="M30.3994691,15.1849743 C30.3994691,15.1849743 27.692284,13.252598 26.2742346,12.0862812 C25.9249753,11.7991525 25.6188765,11.4643604 25.3235679,11.1209545 C24.7357901,10.4358653 24.3331481,10.6724594 24.6642346,11.5476277 C25.1827284,12.920103 26.496284,14.680202 30.0059136,16.9611525" id="Fill-25" fill="#2F302F"></path>
                            <path d="M23.4232568,34.5967129 C23.4397259,35.1451287 23.1211333,35.589604 22.7116765,35.589604 C22.3022198,35.589604 21.9569358,35.1451287 21.9410346,34.5967129 C21.9245654,34.048297 22.243158,33.6038218 22.6526148,33.6038218 C23.0620716,33.6038218 23.4067877,34.048297 23.4232568,34.5967129" id="Fill-27" fill="#FEFEFE"></path>
                        </g>
                    </g>
                    <path d="M63.9540151,33.3806452 C65.4927934,33.3806452 66.2752231,32.6064516 66.2752231,31.0580645 L66.2752231,10.5419355 L64.8146877,10.5419355 L64.8146877,30.6967742 C64.8146877,31.6 64.3452299,32.0645161 63.4323953,32.0645161 C62.1805079,32.0645161 60.8764585,32.0129032 59.4941661,31.9612903 L59.8332189,33.3806452 L63.9540151,33.3806452 Z M57.8510638,16.5290323 C56.7556623,21.2774194 55.138641,25.0709677 53,27.8580645 L54.2258065,28.8903226 C56.3122855,26.1806452 57.9814688,22.2322581 59.2594372,17.0709677 L57.8510638,16.5290323 Z M71.9869595,15.9354839 L70.7089911,16.7096774 C72.8476321,21.2 74.5428964,25.2774194 75.7947838,28.9935484 L77.0727522,28.116129 C75.8991078,24.6580645 74.2038435,20.5806452 71.9869595,15.9354839 Z M79.4722032,18.2064516 L79.4722032,19.5483871 L86.618394,19.5483871 C86.0706932,21.3290323 85.4708305,23.0322581 84.8448868,24.683871 L97.9114619,24.683871 C96.4770075,26.5935484 94.4687714,28.4258065 91.9128346,30.1548387 C90.0089224,29.4580645 88.0267673,28.8129032 85.9663693,28.2451613 L85.2100206,29.3548387 C89.3829787,30.4903226 93.4776939,32.0387097 97.4680851,34 L98.2505148,32.8129032 C96.7117364,32.0645161 95.0947152,31.3677419 93.3994509,30.7225806 C96.2161977,28.7096774 98.2505148,26.6709677 99.5545642,24.6064516 L99.5545642,23.3677419 L86.8270419,23.3677419 C87.2704187,22.2064516 87.7137955,20.9419355 88.1310913,19.5483871 L102.788607,19.5483871 L102.788607,18.2064516 L88.5223061,18.2064516 C88.835278,17.0709677 89.1221688,15.8580645 89.4351407,14.5677419 L101.223747,14.5677419 L101.223747,13.2516129 L89.7481126,13.2516129 C89.9567605,12.2709677 90.1654084,11.2387097 90.3740563,10.1290323 L88.9656829,10 C88.757035,11.083871 88.5223061,12.1677419 88.2875772,13.2516129 L81.2717914,13.2516129 L81.2717914,14.5677419 L87.9746054,14.5677419 C87.6616335,15.7806452 87.3486616,16.9935484 87.0096088,18.2064516 L79.4722032,18.2064516 Z M117.524365,10.516129 C118.463281,11.9096774 119.350034,13.4580645 120.184626,15.1096774 L118.906658,15.7290323 C118.072066,14 117.211393,12.4516129 116.272478,11.1096774 L117.524365,10.516129 Z M125.609472,10.2064516 L127.017845,10.6967742 C126.235415,13.0451613 125.348662,15.1096774 124.331503,16.916129 L128.21757,16.916129 L128.21757,18.2580645 L115.411805,18.2580645 L115.411805,16.916129 L122.897049,16.916129 C123.940288,14.8516129 124.853123,12.6064516 125.609472,10.2064516 Z M111.082361,19.8580645 L111.082361,33.5870968 L109.700069,33.5870968 L109.700069,19.3935484 C108.735072,22.3096774 107.404942,24.916129 105.683596,27.2129032 L105.083734,25.7419355 C107.222375,23.1096774 108.708991,20.0903226 109.595745,16.7096774 L105.709677,16.7096774 L105.709677,15.3419355 L109.700069,15.3419355 L109.700069,10.1548387 L111.082361,10.1548387 L111.082361,15.3419355 L114.394647,15.3419355 L114.394647,16.7096774 L111.082361,16.7096774 L111.082361,18.3354839 C112.412491,19.7290323 113.742622,21.3032258 115.098833,23.0322581 L114.290323,24.2451613 C113.038435,22.3870968 111.969115,20.916129 111.082361,19.8580645 Z M114.316404,30.8 L129,30.8 L129,32.1935484 L114.316404,32.1935484 L114.316404,30.8 Z M116.246397,23.6258065 L116.246397,24.9677419 L127.382979,24.9677419 L127.382979,23.6258065 L116.246397,23.6258065 Z" id="&#23567;&#19987;&#26639;" fill="#C7C7C7"></path>
                </g>
            </g>
        </g>
    </g>
</svg>

            </a>

            <div class="metabar-inner">
              <div class='u-clearfix u-relative'>
                <div class="xzl-header-body">
                  <a href="/", class="xzl-logo-link">
                      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="129px" height="58px" viewBox="0 0 129 58" version="1.1" class="xzl-logo">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title></title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="&#20999;&#22270;" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-472.000000, -200.000000)" id="icon_top_logo">
            <g transform="translate(472.000000, 200.000000)">
                <g id="Group-41">
                    <g id="Group-2">
                        <g id="Page-1">
                            <path d="M23.9123901,41.7443802 C23.9123901,41.7443802 19.2192543,44.5151723 16.162242,44.5817861 C13.9866123,44.6294495 12.0035012,43.6474693 11.0397728,43.0760832 C10.7206123,42.8877267 10.6746123,42.4415287 10.9432296,42.1848356 L32.4956494,21.521905 C32.4956494,21.521905 34.056242,25.6910139 32.8937481,27.4488158 C31.7312543,29.2066178 29.5391556,29.7768554 29.5391556,29.7768554 C29.5391556,29.7768554 41.5860444,39.8912515 45.492637,57.2493307 L25.4917235,57.4382614 C25.4917235,57.4382614 29.5914025,42.3186376 23.9123901,41.7443802" id="Fill-1" fill="#2F302F"></path>
                            <path d="M27.7058,2.0516495 C27.142442,1.64048119 26.4212074,2.3026 26.7727383,2.90901584 C27.2849852,3.79279802 27.8040469,4.76731287 28.0578988,5.48054059 C30.5657506,10.5443426 30.4215037,17.7524218 27.2912321,23.4858079 C25.1678494,27.3752535 22.0148617,29.9272535 18.6398247,30.4871545 C17.7862691,30.628996 15.5362444,30.6634515 13.7377012,30.0202832 C11.8488617,29.3443822 10.4217259,27.9851149 10.0696272,27.9529564 C9.23651605,27.8754317 10.191158,29.3392139 10.3814049,29.5155109 C12.3701951,31.3548574 14.774121,32.3230554 17.2831086,32.3230554 C17.8237506,32.3230554 18.3689358,32.2782634 18.9158247,32.1875307 C22.8087877,31.5409168 26.4053062,28.672501 28.7825407,24.3184812 C32.6084914,17.3113921 32.2972815,8.21285743 28.3657012,2.65289703 C28.2379235,2.4725802 27.9977012,2.26412475 27.7058,2.0516495" id="Fill-3" fill="#2F302F"></path>
                            <path d="M22.537558,29.4592337 C20.036521,29.4592337 17.5956815,28.1384416 15.9345704,26.4323228 C15.6046198,26.0935109 16.0720025,25.8184416 16.4922494,26.0320653 C18.6786691,27.1415307 22.1962494,28.5473129 24.8449407,27.1817287 C25.263484,26.9658079 25.7768667,27.1334911 25.9909654,27.5578673 C26.2044963,27.9816693 26.0381012,28.500798 25.6189901,28.7167188 C24.6155086,29.2335505 23.5711383,29.4592337 22.537558,29.4592337" id="Fill-5" fill="#2F302F"></path>
                            <path d="M37.4898864,3.49935248 C39.8273679,2.31925347 42.7049235,3.35291683 42.7049235,3.35291683 C42.7049235,3.35291683 41.7923062,6.29943168 39.4548247,7.47953069 C37.1167753,8.6596297 34.2392198,7.62596634 34.2392198,7.62596634 C34.2392198,7.62596634 35.1524049,4.67945149 37.4898864,3.49935248" id="Fill-7" fill="#E96D4E"></path>
                            <path d="M35.1822765,15.2556079 C37.2448938,14.8105584 39.2876346,16.2048554 39.2876346,16.2048554 C39.2876346,16.2048554 37.9865728,18.3209941 35.9239556,18.7666178 C33.8613383,19.2122416 31.8180296,17.8173703 31.8180296,17.8173703 C31.8180296,17.8173703 33.1190914,15.7006574 35.1822765,15.2556079" id="Fill-9" fill="#E96D4E"></path>
                            <path d="M31.2196889,3.02237426 C31.1146272,1.4018198 32.3787753,5.74257426e-05 32.3787753,5.74257426e-05 C32.3787753,5.74257426e-05 33.8127259,1.22494851 33.9177877,2.84550297 C34.0222815,4.46605743 32.7581333,5.8678198 32.7581333,5.8678198 C32.7581333,5.8678198 31.3241827,4.64292871 31.2196889,3.02237426" id="Fill-11" fill="#E96D4E"></path>
                            <path d="M20.8261309,14.3684376 C19.0633654,14.3954277 17.6123778,12.9167149 17.6123778,12.9167149 C17.6123778,12.9167149 19.0207728,11.3943584 20.7835383,11.3673683 C22.5468716,11.3403782 23.9972914,12.8190911 23.9972914,12.8190911 C23.9972914,12.8190911 22.5888963,14.3414475 20.8261309,14.3684376" id="Fill-13" fill="#E96D4E"></path>
                            <path d="M4.78099012,32.1154614 C2.47417531,32.837303 0.000397530864,31.4441545 0.000397530864,31.4441545 C0.000397530864,31.4441545 1.26624938,28.8818178 3.5730642,28.1599762 C5.87987901,27.4387089 8.35422469,28.8312832 8.35422469,28.8312832 C8.35422469,28.8312832 7.08780494,31.3941941 4.78099012,32.1154614" id="Fill-15" fill="#E96D4E"></path>
                            <path d="M8.88685926,26.3325168 C7.2041679,25.8380812 6.25520494,23.9952891 6.25520494,23.9952891 C6.25520494,23.9952891 8.03443951,22.9541604 9.71656296,23.448596 C11.3992543,23.9424574 12.3482173,25.7858238 12.3482173,25.7858238 C12.3482173,25.7858238 10.5689827,26.8269525 8.88685926,26.3325168" id="Fill-17" fill="#E96D4E"></path>
                            <path d="M14.0892321,21.7925525 C14.0625407,19.7240772 15.7741951,18.0248495 15.7741951,18.0248495 C15.7741951,18.0248495 17.5301457,19.6792851 17.556837,21.7471861 C17.5840963,23.8156614 15.8718741,25.5148891 15.8718741,25.5148891 C15.8718741,25.5148891 14.1159235,23.8610277 14.0892321,21.7925525" id="Fill-19" fill="#E96D4E"></path>
                            <path d="M24.5324247,5.05444158 C26.4462519,6.85244158 26.4996346,9.93907525 26.4996346,9.93907525 C26.4996346,9.93907525 23.4505728,10.1107782 21.5367457,8.31277822 C19.6229185,6.51477822 19.5695358,3.42814455 19.5695358,3.42814455 C19.5695358,3.42814455 22.6185975,3.25644158 24.5324247,5.05444158" id="Fill-21" fill="#E96D4E"></path>
                            <path d="M30.2585728,10.221897 C31.5732642,9.29504554 32.6948691,7.38678812 33.4365481,6.26124356 C33.6307704,5.96492673 34.0845235,6.1946297 33.9686716,6.52999604 C33.3224,8.39633267 32.1911407,10.8369267 30.4522272,11.9693624" id="Fill-23" fill="#2F302F"></path>
                            <path d="M30.3994691,15.1849743 C30.3994691,15.1849743 27.692284,13.252598 26.2742346,12.0862812 C25.9249753,11.7991525 25.6188765,11.4643604 25.3235679,11.1209545 C24.7357901,10.4358653 24.3331481,10.6724594 24.6642346,11.5476277 C25.1827284,12.920103 26.496284,14.680202 30.0059136,16.9611525" id="Fill-25" fill="#2F302F"></path>
                            <path d="M23.4232568,34.5967129 C23.4397259,35.1451287 23.1211333,35.589604 22.7116765,35.589604 C22.3022198,35.589604 21.9569358,35.1451287 21.9410346,34.5967129 C21.9245654,34.048297 22.243158,33.6038218 22.6526148,33.6038218 C23.0620716,33.6038218 23.4067877,34.048297 23.4232568,34.5967129" id="Fill-27" fill="#FEFEFE"></path>
                        </g>
                    </g>
                    <path d="M63.9540151,33.3806452 C65.4927934,33.3806452 66.2752231,32.6064516 66.2752231,31.0580645 L66.2752231,10.5419355 L64.8146877,10.5419355 L64.8146877,30.6967742 C64.8146877,31.6 64.3452299,32.0645161 63.4323953,32.0645161 C62.1805079,32.0645161 60.8764585,32.0129032 59.4941661,31.9612903 L59.8332189,33.3806452 L63.9540151,33.3806452 Z M57.8510638,16.5290323 C56.7556623,21.2774194 55.138641,25.0709677 53,27.8580645 L54.2258065,28.8903226 C56.3122855,26.1806452 57.9814688,22.2322581 59.2594372,17.0709677 L57.8510638,16.5290323 Z M71.9869595,15.9354839 L70.7089911,16.7096774 C72.8476321,21.2 74.5428964,25.2774194 75.7947838,28.9935484 L77.0727522,28.116129 C75.8991078,24.6580645 74.2038435,20.5806452 71.9869595,15.9354839 Z M79.4722032,18.2064516 L79.4722032,19.5483871 L86.618394,19.5483871 C86.0706932,21.3290323 85.4708305,23.0322581 84.8448868,24.683871 L97.9114619,24.683871 C96.4770075,26.5935484 94.4687714,28.4258065 91.9128346,30.1548387 C90.0089224,29.4580645 88.0267673,28.8129032 85.9663693,28.2451613 L85.2100206,29.3548387 C89.3829787,30.4903226 93.4776939,32.0387097 97.4680851,34 L98.2505148,32.8129032 C96.7117364,32.0645161 95.0947152,31.3677419 93.3994509,30.7225806 C96.2161977,28.7096774 98.2505148,26.6709677 99.5545642,24.6064516 L99.5545642,23.3677419 L86.8270419,23.3677419 C87.2704187,22.2064516 87.7137955,20.9419355 88.1310913,19.5483871 L102.788607,19.5483871 L102.788607,18.2064516 L88.5223061,18.2064516 C88.835278,17.0709677 89.1221688,15.8580645 89.4351407,14.5677419 L101.223747,14.5677419 L101.223747,13.2516129 L89.7481126,13.2516129 C89.9567605,12.2709677 90.1654084,11.2387097 90.3740563,10.1290323 L88.9656829,10 C88.757035,11.083871 88.5223061,12.1677419 88.2875772,13.2516129 L81.2717914,13.2516129 L81.2717914,14.5677419 L87.9746054,14.5677419 C87.6616335,15.7806452 87.3486616,16.9935484 87.0096088,18.2064516 L79.4722032,18.2064516 Z M117.524365,10.516129 C118.463281,11.9096774 119.350034,13.4580645 120.184626,15.1096774 L118.906658,15.7290323 C118.072066,14 117.211393,12.4516129 116.272478,11.1096774 L117.524365,10.516129 Z M125.609472,10.2064516 L127.017845,10.6967742 C126.235415,13.0451613 125.348662,15.1096774 124.331503,16.916129 L128.21757,16.916129 L128.21757,18.2580645 L115.411805,18.2580645 L115.411805,16.916129 L122.897049,16.916129 C123.940288,14.8516129 124.853123,12.6064516 125.609472,10.2064516 Z M111.082361,19.8580645 L111.082361,33.5870968 L109.700069,33.5870968 L109.700069,19.3935484 C108.735072,22.3096774 107.404942,24.916129 105.683596,27.2129032 L105.083734,25.7419355 C107.222375,23.1096774 108.708991,20.0903226 109.595745,16.7096774 L105.709677,16.7096774 L105.709677,15.3419355 L109.700069,15.3419355 L109.700069,10.1548387 L111.082361,10.1548387 L111.082361,15.3419355 L114.394647,15.3419355 L114.394647,16.7096774 L111.082361,16.7096774 L111.082361,18.3354839 C112.412491,19.7290323 113.742622,21.3032258 115.098833,23.0322581 L114.290323,24.2451613 C113.038435,22.3870968 111.969115,20.916129 111.082361,19.8580645 Z M114.316404,30.8 L129,30.8 L129,32.1935484 L114.316404,32.1935484 L114.316404,30.8 Z M116.246397,23.6258065 L116.246397,24.9677419 L127.382979,24.9677419 L127.382979,23.6258065 L116.246397,23.6258065 Z" id="&#23567;&#19987;&#26639;" fill="#C7C7C7"></path>
                </g>
            </g>
        </g>
    </g>
</svg>

                  </a>
                    <div class="xzl-nav-header-center">
    <div class="metabar-block metabar-center xzl-pull-left xzl-nav-header">
      <div class="xzl-button-set ">
          <div class="xzl-header-link zhuanlan-topic-header">
            <a href="/onevcat">
              <img class="xzl-header-zhuanlan-logo" src="https://diycode.b0.upaiyun.com/photo/2018/9021d4e3be07af500ab6cd26c6726517.jpg" alt="9021d4e3be07af500ab6cd26c6726517" />
</a>            <span class='xzl-zhuanlan-name'><a href="/onevcat">开发笔记簿</a></span>
                <button class="button button--small zhuanlan-subscribe-btn link-btn xzl-btn-with-chrome xzl-base-color-normal-btn" data-link-url="/onevcat/subscribe">
                  <span class="button-label  xzl-default-state-btn">
                    99元订阅
                  </span>
                </button>
          </div>
      </div>
    </div>
  </div>
<div class="metabar-block u-float-right  zhualan-header-btn xzl-header-right xzl-nav-header ">
  <div class="xzl-button-set">
      <button class="button link-btn apply-zhuanlan-btn xzl-btn-with-chrome xzl-base-color-normal-btn" data-link-url="/publication/new">
        <span class="button-label  xzl-default-state-btn">
          申请专栏
        </span>
      </button>
      <a class="button  topic-write-btn xzl-btn-with-chrome xzl-red-color-normal-btn" data-turbolinks='false' href="/topic/new">
        <span class="button-label  xzl-default-state-btn">
          写文章
        </span>
      </a>
      <div class="xzl-search-div  "
    title="搜索 文章、用户">
        <input class="js-predictiveSearchInput xzl-search-input textInput hidden  textInput--darkText u-baseColor--textNormal textInput--transparent"
        type="search" placeholder="搜索 文章、用户" value="" data-search-type=" " onkeydown="return checkKeyForSearchInput(event)">
        <span class="xzl-search-btn">
          <svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25">
  <path d="M20.067 18.933l-4.157-4.157a6 6 0 1 0-.884.884l4.157 4.157a.624.624 0 1 0 .884-.884zM6.5 11c0-2.62 2.13-4.75 4.75-4.75S16 8.38 16 11s-2.13 4.75-4.75 4.75S6.5 13.62 6.5 11z">
  </path>
</svg>

        </span>
      </div>
      <button class="button xzl-primary-btn  xzl-notify-btn button--circle xzl-button-chrome-less is-touchIconBlackPulse is-inSiteNavBar  button--withIcon button--withSvgIcon button--activity js-notificationsButton link-btn is-counter" style="width: 36px; height: 36px;" data-link-url="/notifications">
        <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.666668 21.333332" height="21.333332" width="18.666668" xml:space="preserve" id="svg2" version="1.1" class="notice-icon"><metadata id="metadata8"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"></dc:type></cc:Work></rdf:RDF></metadata><defs id="defs6"><clipPath id="clipPath20" clipPathUnits="userSpaceOnUse"><path style="clip-rule:evenodd" id="path18" d="M 79.9531,149.012 C 102.797,144.414 120,124.289 120,99.9766 v -20.336 c 0.684,-1.1093 1.203,-2.2695 1.535,-3.4883 C 128.891,49.418 140,30 140,30 H 0 c 0,0 18.4648,19.3594 18.4648,46.1523 0,2.0118 0.5352,3.8672 1.5352,5.5743 v 18.25 C 20,124.191 37.2383,144.383 60.0469,149.008 60.0156,149.332 60,149.664 60,150 c 0,5.523 4.4766,10 10,10 5.5234,0 10,-4.477 10,-10 0,-0.332 -0.0156,-0.66 -0.0469,-0.988 z"></path></clipPath><clipPath id="clipPath26" clipPathUnits="userSpaceOnUse"><path id="path24" d="M 0,0 H 140 V 160 H 0 Z"></path></clipPath><clipPath id="clipPath36" clipPathUnits="userSpaceOnUse"><path style="clip-rule:evenodd" id="path34" d="M 50,20 C 50,8.95313 58.9531,0 70,0 v 0 c 11.0469,0 20,8.95313 20,20"></path></clipPath><clipPath id="clipPath42" clipPathUnits="userSpaceOnUse"><path id="path40" d="M 0,0 H 140 V 160 H 0 Z"></path></clipPath></defs><g transform="matrix(1.3333333,0,0,-1.3333333,0,21.333333)" id="g10"><g transform="scale(0.1)" id="g12"><g id="g14"><g clip-path="url(#clipPath20)" id="g16"><g clip-path="url(#clipPath26)" id="g22"><path id="path28" style="fill:none;stroke:#2b2b2c;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" d="M 79.9531,149.012 C 102.797,144.414 120,124.289 120,99.9766 v -20.336 c 0.684,-1.1093 1.203,-2.2695 1.535,-3.4883 C 128.891,49.418 140,30 140,30 H 0 c 0,0 18.4648,19.3594 18.4648,46.1523 0,2.0118 0.5352,3.8672 1.5352,5.5743 v 18.25 C 20,124.191 37.2383,144.383 60.0469,149.008 60.0156,149.332 60,149.664 60,150 c 0,5.523 4.4766,10 10,10 5.5234,0 10,-4.477 10,-10 0,-0.332 -0.0156,-0.66 -0.0469,-0.988 z"></path></g></g></g><g id="g30"><g clip-path="url(#clipPath36)" id="g32"><g clip-path="url(#clipPath42)" id="g38"><path id="path44" style="fill:none;stroke:#2b2b2c;stroke-width:20;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1" d="M 50,20 C 50,8.95313 58.9531,0 70,0 v 0 c 11.0469,0 20,8.95313 20,20"></path></g></g></g></g></g></svg>

        <span class="notifications-count notifications-count-0"></span>
      </button>
      <div class="nav-user-btn">
        <div class="xzl-popover js-popover popover--menu popover--userActions u-resetSpectrum popover--bottom">
  <div class="popover-inner js-popover-inner">
    <ul role="menu" class="list list--borderless list--short list--large">
      <li class="list-item  profile-list-item list-item--dark u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/u/SaiDicaprio">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16px" height="19px" viewBox="0 0 16 19" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_home</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-103.000000, -272.000000)" id="icon_title_home">
            <g transform="translate(101.000000, 271.000000)">
                <rect id="Rectangle-6" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <path d="M2.5,7.05988314 L2.5,18.5481306 L17.5,18.5481306 L17.5,7.05792375 L10.0504226,1.61772806 L2.5,7.05988314 Z" id="Rectangle-5" stroke="#818181"></path>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>我的主页</span>
        </a>
      </li>
      <li class="list-item list-item--dark u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/me/publications">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16px" height="20px" viewBox="0 0 16 20" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_write</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-103.000000, -309.000000)" id="icon_title_write">
            <g transform="translate(101.000000, 309.000000)">
                <rect id="Rectangle-6-Copy-3" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <g id="Group-11" transform="translate(3.000000, 1.000000)">
                    <path d="M12.0961903,0.007217431 C12.0950805,0.0840940228 12.0950805,0.0840940228 12.0906395,0.395412629 C12.0850882,0.787332723 12.0850882,0.787332723 12.0784271,1.26720127 C12.0777553,1.31600737 12.0777553,1.31600737 12.0770847,1.36488756 C12.0668478,2.11165141 12.0607067,2.60264713 12.0607067,2.69788938 C12.0607067,6.32194788 12.289768,6.9994991 14.1388632,7.82437955 L14.7391139,8.09215109 L14.3208675,8.59917427 C14.2665361,8.66503806 14.1640261,8.79017314 14.0202307,8.96709441 C13.7802215,9.26239406 13.5126946,9.59453175 13.224549,9.95601411 C12.4013961,10.9886699 11.5783121,12.0490614 10.810665,13.0769552 C10.5999821,13.3590636 10.3960273,13.6353691 10.199511,13.905095 C8.79888518,15.8275065 7.84211607,17.324416 7.50283568,18.1836368 L6.99871818,19.4603042 L6.56357072,18.1585128 C6.31659787,17.4196664 5.27609449,15.8389268 3.69252103,13.7328647 C3.51910808,13.5022353 3.340172,13.2666053 3.1561826,13.026487 C2.38210362,12.0162628 1.55216778,10.9696955 0.722164795,9.94741462 C0.431620618,9.58956318 0.161861606,9.26035845 -0.0801598352,8.96734649 C-0.225186026,8.79176531 -0.32859731,8.66743427 -0.383446471,8.60189193 L-0.81077199,8.09125674 L-0.201226262,7.82328398 C1.66784689,7.00158895 1.88639943,6.41530449 1.87559852,3.22164643 C1.87474274,2.96591436 1.87445639,2.84929113 1.87445639,2.69788938 C1.87445639,2.01038775 1.85698975,0.201713964 1.8415311,0.0510256659 L1.78500307,-0.5 L12.1035127,-0.5 L12.0961903,0.007217431 Z" id="Combined-Shape" stroke="#818181" stroke-linejoin="round"></path>
                    <rect id="Rectangle-23" fill="#818181" x="6.5" y="8" width="1" height="10"></rect>
                    <circle id="Oval-7" fill="#818181" cx="7" cy="8" r="1"></circle>
                </g>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>我的专栏</span>
        </a>
      </li>
      <li class="list-item list-item--dark u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/me/subscribes">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16px" height="18px" viewBox="0 0 16 18" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_booking</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-103.000000, -348.000000)" id="icon_title_booking">
            <g transform="translate(101.000000, 347.000000)">
                <rect id="Rectangle-6-Copy-4" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <g id="Group-10" transform="translate(2.000000, 1.000000)" stroke="#818181">
                    <rect id="Rectangle-24" x="0.5" y="0.5" width="15" height="17" rx="2"></rect>
                    <path d="M8.5,0.5 L8.5,7.32310369 L11,6.55419486 L13.5,7.32310369 L13.5,0.5 L8.5,0.5 Z" id="icon_mark-copy"></path>
                </g>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>我的订阅</span>
        </a>
      </li>
      <li class="list-item list-item--separator list-item--separator-zero">
      </li>
      <li class="list-item topic-list-item list-item--dark u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/me/topics" tabindex="-1" role="menuitem">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14px" height="16px" viewBox="0 0 14 16" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_word</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-155.000000, -273.000000)" id="icon_title_word">
            <g transform="translate(152.000000, 271.000000)">
                <rect id="Rectangle-6-Copy-5" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <g id="Group-9" transform="translate(3.000000, 2.000000)">
                    <path d="M0.5,0.5 L0.5,15.5 L13.5,15.5 L13.5,3.25704929 L10.8221801,0.5 L0.5,0.5 Z" id="Rectangle-21" stroke="#818181"></path>
                    <rect id="Rectangle-22" fill="#818181" x="3" y="4" width="4" height="1"></rect>
                    <rect id="Rectangle-22-Copy" fill="#818181" x="3" y="7" width="8" height="1"></rect>
                    <rect id="Rectangle-22-Copy-2" fill="#818181" x="3" y="10" width="8" height="1"></rect>
                </g>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>我的文章</span>
        </a>
      </li>
      <li class="list-item list-item--dark u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/me/drafts" tabindex="-1" role="menuitem">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16px" height="15px" viewBox="0 0 16 15" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_draft</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-154.000000, -312.000000)" id="icon_title_draft">
            <g transform="translate(152.000000, 309.000000)">
                <rect id="Path" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <path d="M2.5,10.6911545 L2.5,15.5863661 C2.5,16.4258256 3.16515947,17.0922852 3.99406028,17.0922852 L16.0059397,17.0922852 C16.8293478,17.0922852 17.5,16.4180516 17.5,15.5863661 L17.5,10.6857048 L14.7177287,3.5 L5.45966255,3.5 L2.5,10.6911545 Z" id="Rectangle-40" stroke="#818181"></path>
                <path d="M14,11 L14,12.334029 C14,12.7018346 13.6354685,13 13.2036819,13 L6.79631805,13 C6.35652374,13 6,12.7048931 6,12.334029 L6,11" id="Rectangle-41" stroke="#818181"></path>
                <rect id="Rectangle-20" fill="#818181" x="2" y="11" width="4" height="1"></rect>
                <rect id="Rectangle-20-Copy" fill="#818181" x="14" y="11" width="4" height="1"></rect>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>我的草稿</span>
        </a>
      </li>
      <li class="list-item list-item--dark u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/me/collections" tabindex="-1" role="menuitem">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14px" height="18px" viewBox="0 0 14 18" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_mark</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-155.000000, -348.000000)" id="icon_title_mark">
            <g transform="translate(152.000000, 347.000000)">
                <rect id="Rectangle-6-Copy" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <path d="M3.5,18.330184 L10,16.4024198 L16.5,18.330184 L16.5,2.99508929 C16.5,2.16960364 15.8266399,1.5 14.9941413,1.5 L5.00585866,1.5 C4.1729829,1.5 3.5,2.16959875 3.5,2.99508929 L3.5,18.330184 Z" id="icon_mark" stroke="#818181"></path>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>我的收藏</span>
        </a>
      </li>
      <li class="list-item list-item--dark u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/wallet" tabindex="-1" role="menuitem">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16px" height="15px" viewBox="0 0 16 15" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_wallet</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-205.000000, -274.000000)" id="icon_title_wallet">
            <g transform="translate(203.000000, 271.000000)">
                <rect id="Rectangle-6-Copy-2" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <g id="Group-14" transform="translate(2.000000, 3.000000)">
                    <path d="M15.5,14.5 L15.5,0.5 L1.99406028,0.5 C1.16986472,0.5 0.5,1.16873005 0.5,1.99188419 L0.5,13.0081158 C0.5,13.8309529 1.16940651,14.5 1.99406028,14.5 L15.5,14.5 Z" id="Rectangle-15" stroke="#818181"></path>
                    <path d="M15.5,3.5 L15.5,0.5 L1.99406028,0.5 C1.17032001,0.5 0.5,1.17191112 0.5,2 C0.5,2.83350313 1.16628956,3.5 1.99406028,3.5 L15.5,3.5 Z" id="Rectangle-15-Copy" stroke="#818181"></path>
                    <path d="M15.5,10.5 L15.5,7.5 L11.0059191,7.5 C10.1667923,7.5 9.5,8.16747386 9.5,9 C9.5,9.83283752 10.1709214,10.5 11.0059191,10.5 L15.5,10.5 Z" id="Rectangle-15-Copy-2" stroke="#818181"></path>
                    <rect id="Rectangle-16" fill="#FFFFFF" x="15" y="1" width="1" height="2"></rect>
                </g>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>我的钱包</span>
        </a>
      </li>
      <li class="list-item list-item--separator list-item--separator-part-one">
      </li>
      <li class="list-item setting-list-item u-padding0">
        <a class="button--dark xzl-button-chrome-less u-baseColor--buttonDark"
        href="/me/settings" tabindex="-1" role="menuitem">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16px" height="19px" viewBox="0 0 16 19" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_setting</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-205.000000, -309.000000)" id="icon_title_setting">
            <g transform="translate(203.000000, 309.000000)">
                <rect id="Rectangle-6-Copy-7" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <g id="Group-15" transform="translate(2.000000, 0.000000)" stroke="#818181">
                    <path d="M7.86121593,1.42264973 L0.5,5.67264973 L0.5,14.1726497 L7.86121593,18.4226497 L15.2224319,14.1726497 L15.2224319,5.67264973 L7.86121593,1.42264973 Z" id="Polygon"></path>
                    <circle id="Oval-14" cx="8" cy="10" r="2.5"></circle>
                </g>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>设置</span>
        </a>
      </li>

      <li class="list-item u-padding0">
        <a href="/account/sign_out" class="button--dark xzl-button-chrome-less u-baseColor--buttonDark" data-method="delete">
          <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18px" height="15px" viewBox="0 0 18 15" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title>icon_title_quit</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-205.000000, -350.000000)" id="icon_title_quit">
            <g transform="translate(203.000000, 347.000000)">
                <rect id="Rectangle-6-Copy-2" fill="#FF0000" opacity="0" x="0" y="0" width="20" height="20"></rect>
                <g id="Group-16" transform="translate(2.000000, 3.000000)" stroke="#818181">
                    <polyline id="Rectangle-19" transform="translate(12.000000, 7.535534) rotate(-45.000000) translate(-12.000000, -7.535534) " points="15.2071068 4.32842712 15.2071068 10.7426407 8.79289322 10.7426407"></polyline>
                    <rect id="Rectangle-18" x="5.5" y="7.5" width="10" height="1"></rect>
                    <path d="M8.5,14.5 L8.5,0.5 L0.5,0.5 L0.5,14.5 L8.5,14.5 Z" id="Rectangle-39"></path>
                </g>
            </g>
        </g>
    </g>
</svg>
</div>
          <span>退出</span>
        </a>
      </li>
    </ul>
  </div>
  <div class="popover-arrow">
  </div>
</div>

<script type="text/javascript">
  $(".nav-user-btn").click(function(e){
    $(".xzl-invite-card").hide()
    if($(".popover--userActions").hasClass("is-active")){
      $(".popover--userActions").removeClass("is-active")
    }else{
      $(".popover--userActions").addClass("is-active")
      $(".popover--userActions").show()
    }
    e.stopPropagation()
  })

  $(".xzl-popover").off("click").click(function(e){
    e.stopPropagation()
  })
  $(window).click(function(e) {
    $(".xzl-popover").hide()
    $(".popover--userActions").removeClass("is-active")
    if($(".is-search").length == 0){
      $(".xzl-search-div").removeClass("is-active")
      $(".xzl-search-input").addClass("hidden")
    }
  });
</script>
        <img class="cirle-user-avatar-36" src="https://diycode.b0.upaiyun.com/photo/2018/061c2c5bebe346972ed5e6c5af28a877." alt="061c2c5bebe346972ed5e6c5af28a877" />
      </div>
    
  </div>
</div>

<script type="text/javascript">
  function submitSearchQuery(){
    var key = $(".xzl-search-input").val()
    if(!key){
      $(".xzl-search-div").removeClass("is-active")
      $(".xzl-search-input").addClass("hidden")
    }else{
      Turbolinks.visit("/search?q=" + key + "&type=" + $(".xzl-search-input").data("search-type"), { action: "replace" })
    }
  }
  $(".xzl-search-btn").unbind("click")
  $(".xzl-search-btn").click(function(e){
    if($(".xzl-search-div").hasClass("is-active")){
      submitSearchQuery()
    }else{
      $(".xzl-search-div").addClass("is-active")
      $(".xzl-search-input").removeClass("hidden")
      $(".xzl-search-input").focus()
    }
    e.stopPropagation()
  })
  $(".xzl-search-div").unbind("click")
  $(".xzl-search-div").click(function(e){
    e.stopPropagation()
  })

  function checkKeyForSearchInput(event){
    console.log(event)
    if(event.keyCode == 13){
      submitSearchQuery()
    }
  }
</script>

                </div>
              </div>
            </div>
          </div>
        </div>
      <style type="text/css">
  
</style>
<div class="main topic-show-partial-main container">
  <article class="topic-show-partial">
    <div class="xzl-topic-content">
      <section>
        <div class="section-content">
          <div class="section-inner xzl-home-containner xzl-topic-show-body">
              <div class="xzl-aspect-ratio-placeholder-fill">
                <img class="xzl-topic-show" src="https://diycode.b0.upaiyun.com/photo/2018/f5e14921eaf8bf786d8f6d7a36e4e9a1.png" alt="F5e14921eaf8bf786d8f6d7a36e4e9a1" />
              </div>
            <div class="topic-title">
              简单又不简单的 Bool - Swift 标准库源码导读 (二)
            </div>
            <div class="topic-header">
              <div class="postMetaInline">
                <div class="xzl-flex-center">
                  <div class="post-meta-inline-avatar u-flex0">
                    <a class="link avatar xzl-link-color" href="/u/onevcat">
                      <img class="avatar-image" src="https://diycode.b0.upaiyun.com/photo/2018/1303552bf4de8fb5b9b395a80ecd5b51.jpeg" alt="1303552bf4de8fb5b9b395a80ecd5b51" />
                    </a>
                  </div>
                  <div class="xzl-author-lockup xzl-author-lockup-user u-flex1 u-noWrapWithEllipsis">
                    <div class="xzl-author-lockup-header">
                      <a class="link link link--darken user-name link--accent u-accentColor--textNormal xzl-text-darken xzl-link-color" href="/u/onevcat">
                        onevcat
                      </a>
                        <button class="button xzl-primary-btn link-btn  followed  xzl-basic-btn xzl-btn-with-chrome  btn-follow-user "
                          data-user-id="46968"
                          data-followed="true" data-following-btn=true>
                            <span class="button-label  xzl-default-state-btn js-buttonLabel" >
                              已关注
                            </span>
                        </button>
                    </div>
                    <div class="xzl-author-lockup xzl-author-lockup-time">
                      <span class="read_time">
                        预计阅读时间10分钟
                      </span>
                      <span class="time"><abbr class="timeago" title="2018-04-02T15:24:41+08:00"></abbr></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
              <textarea class="hidden hidden_topic_body hidden_markdown_body" data-summary="在[上一篇文章](https://xiaozhuanlan.com/topic/3265840179)中，我们搭建了 Swift 标准库的开发环境。从这篇文章开始，我们来尝试读读看 Swift 标准库中的一些实现。

当然从简单的开始，比如 `Bool` 类型就是一个很好的 starting point。[现在版本的 `Bool.swift`](https://github.com/apple/swift/blob/86fb3faaee5cf8759bfe329b996bfb224eaebc82/stdlib/public/core/Bool.swift) 代码，加上各种标注和注释，也不过区区 300 多行。你完全可以打开上面的链接，花几分钟阅读一下实现，然后再回到本文来看看我们能有什么样的发现。

## 标准库中常用的 Attribute

很多时候，我们很快就会被开头的几行震慑住：

```swift
@_fixed_layout
public struct Bool {
  @_versioned
  internal var _value: Builtin.Int1

  @_inlineable
  @_transparent
  public init() {
    let zero: Int8 = 0
    self._value = Builtin.trunc_Int8_Int1(zero._value)
  }
```

`@_fixed_layout`！`@_versioned`！`@_inlineable`！`@_transparent`！ 全是一些我们平常写 Swift 没有见过的私有标注...而且如果你完成了前一篇文章中的练习的话，你可以已经注意到了在其他源文件中也充斥着类似的标注。

这些标注大都和 Swift ABI 相关，它们为编译器最终完成 ABI 稳定提供了提示，同时也对性能进行优化。当然，如果你只是想不求甚解地了解一下 Swift 标准库长什么样的话，你大可忽视掉这些标注，并跳到本文的下一节去。不过机会难得，结合 ABI 的一些话题，我还是想对这些标注到底都干了些什么进行一点说明。

### 什么是 Swift ABI，什么是 ABI 稳定

想要说清楚这几个标注的意义，我们需要从 ABI 说起。

API (Application Programming Interface) 的概念我们都很熟悉了，在很大程度上，API 稳定指的是源码级别的兼容，也就是：

* 新版本的编译器应该可以不做修改地编译旧版本的代码

在经过 Swift 3 的阵痛后，从 Swift 4 开始已经达成了源码兼容。不过，Swift Core Team 一直以来最为关心的是尽快做到 ABI 稳定。在运行时，Swift 二进制程序需要通过一套规则 (比如如何调用方法，在哪里能找到需要的类型信息，内存中的数据的布局是怎样等) 来和其他框架进行交互。这套规则定义就是 ABI (Application Binary Interface)。直观来说，ABI 稳定意味着这两件事情：

1. 去年的 app 可以使用今年的框架
2. 明年的 app 也可以使用今年的框架

ABI 稳定对于 Apple 自身非常重要，只有达到 ABI 稳定，Swift 才可能被大范围应用在 Apple 自己的软件框架中。对于我们第三方开发者来说，在没有 ABI 稳定的现在，只要我们在项目中使用了 Swift 代码，我们就需要把同样版本的 Swift 运行时和标准库等打包到最后的项目里。而一旦 ABI 稳定达成，就不再会有此限制，我们将可以直接使用系统自带的 Swift 运行时和标准库运行任意版本的 Swift 代码。

一旦宣称 ABI 稳定，这时候的 ABI 将成为 Swift 编译器规范，后续的编译器开发可以对规范进行添加，但是也必须确保不破坏已有的规范，这将会使这门语言的进化受到很大束缚 (其实有时候也未必是坏事)。这也是 Swift 团队一再推迟宣称 ABI 稳定的时间点的原因，因为必须确保 everything is correct and prepared。

#### Resilient 类型

ABI 一个很重要的方面就是计算和获取内存布局。当框架中的一个类型 `T` 的成员改变时 (比如添加一个新的存储变量)，它的实例在内存中的布局一般也会改变 (比如该成员的 offset 地址增加)。如果 app 里是直接通过 offset 地址来访问框架中类型的某个成员变量的话，当框架中该类型被改变时，除非 app 重新获取新的地址 (也就是重新编译和链接框架)，原来的代码将会错误地访问到其他变量或者甚至崩溃。这时候，`T` 就被叫做易碎 (fragile) 类型。

这让我们无法添加/删除/甚至对属性重新排序，但是框架必须要进化，这些事情难免发生。为了避免这种 fragile 的情况，我们在编译时就不能直接把属性偏移量写到 app 里，也就是说，我们不能将某个类型的内存布局直接暴露出去。在编译期间，编译器会把最新的偏移量信息写到和类型绑定的 metadata 中。在传递这个类型的时候，则使用非透明的布局 (Opaque Layout)，使用者要访问某个成员时，不再是直接通过偏移量直接进行内存地址读取，而是先访问存储了类型中各种信息的 metadata 并找到想要访问的成员的最新地址，然后再进行内存访问。这时候，我们在源码层级就可以任意地增删重排成员变量了。此时，就算换了新的编译器版本，只要 metadata 访问的算法和定义不变，旧版本的 app 依然可以使用新版本的框架。这种类型被称为弹性 (resilient) 类型。

&gt; 根绝类型不同，Type metadata 存储的内容也不尽相同。在[这里](https://github.com/apple/swift/blob/master/docs/ABI/TypeMetadata.rst)可以找到一些文档说明。

#### @_fixed_layout

有了上面的背景知识，我们就可以回到 `Bool.swift` 的源码了。Resilient 类型显然会带来性能上的额外开销，像是 `Bool` 这样的基础中的基础，我们显然是希望它越快越好。这里 `@_fixed_layout` 的作用是，告诉编译器这个 `struct` 的布局也应当被作为编译时考虑的部分。换句话说，这是开发者对编译器所做的保证，保证这个结构体中不会再增加或减少存储变量，也不会改变已有的变量的顺序。由此一来，外部在遇到这样的类型时，就可以放心大胆地直接用内存偏移量进行成员访问，而不必再经由 metadata 了。

#### @_inlineable 或 @_transparent

`@_fixed_layout` 解决了存储属性的性能和 ABI 问题。对于函数来说，最常见的优化方法大概就是将它内联 (inline) 了。inline 相当于将函数的具体实现完全暴露在接口中，编译期间，当 app 对框架中的某个方法进行调用时，编译器如果发现方法可以内联，就将具体实现“复制“过来，替换掉原有的方法调用。这可以减少模块间的方法调用的次数，加速运行时的性能。

`@_inlineable` 做的就是这件事情，为了在 Debug 时保留调用栈的信息，它只在 `-O` 的时候生效。它告诉编译器，在需要的时候可以将所声明的函数进行内联。`@_transparent` 和 `@_inlineable` 类似，不过它在 `-Onone` 时也会生效，并在编译时更早的阶段就被内联插入到目标位置。这样编译器就能在检查数据流 (比如 `if else`) 错误的时候找到可能出现的内联错误。

&gt; `@_transparent` 实际上是比 `@_inlineable` 更强的存在，所有的 `@_transparent` 声明其实也隐式包含了 `@_inlineable`。内联的声明非常有用，Swift 公开文档中还存在 `@inline(__always)` 和 `@inline(never)`，用来”强制“内联和非内联某个函数。

内联会给 ABI 稳定带来很多”陷阱“。最显而易见的是，被内联的方法的实现中的符号都会被外界”看到“。而很多时候这些符号并不是可用的，比如 `Bool` 的 `init` 中对 `self._value` 赋值的部分，`_value` 的 access permission 是 `internal`，这是无法被别的 module 看到的。

#### @_versioned

`@_versioned` 的主要目的就是解决上面的问题。在进行编译时，当遇到 `@_versioned` 的标签时，编译器将会“暂时”在内部将其作为 `public` 进行处理，这样，在 inline 的时候，即使某个 API 是 internal 或者 private 的，我们也依然可以对它进行调用了。

在 ABI 稳定方面，`@_versioned` 的意义也十分重要。我们可以安全地将某个以前就被标记为 `@_versioned` 的方法公开为 public，但是由于实际上这个方法会被外部 module inline 调用，所以我们不能轻易删除或者更改它的调用规则。

### 关于这几个私有 attribute 的总结
" data-enable-update-html="true"  data-update-token="wEmNEETajY+3Wa5Mi/iz1g==" value="在[上一篇文章](https://xiaozhuanlan.com/topic/3265840179)中，我们搭建了 Swift 标准库的开发环境。从这篇文章开始，我们来尝试读读看 Swift 标准库中的一些实现。

当然从简单的开始，比如 `Bool` 类型就是一个很好的 starting point。[现在版本的 `Bool.swift`](https://github.com/apple/swift/blob/86fb3faaee5cf8759bfe329b996bfb224eaebc82/stdlib/public/core/Bool.swift) 代码，加上各种标注和注释，也不过区区 300 多行。你完全可以打开上面的链接，花几分钟阅读一下实现，然后再回到本文来看看我们能有什么样的发现。

## 标准库中常用的 Attribute

很多时候，我们很快就会被开头的几行震慑住：

```swift
@_fixed_layout
public struct Bool {
  @_versioned
  internal var _value: Builtin.Int1

  @_inlineable
  @_transparent
  public init() {
    let zero: Int8 = 0
    self._value = Builtin.trunc_Int8_Int1(zero._value)
  }
```

`@_fixed_layout`！`@_versioned`！`@_inlineable`！`@_transparent`！ 全是一些我们平常写 Swift 没有见过的私有标注...而且如果你完成了前一篇文章中的练习的话，你可以已经注意到了在其他源文件中也充斥着类似的标注。

这些标注大都和 Swift ABI 相关，它们为编译器最终完成 ABI 稳定提供了提示，同时也对性能进行优化。当然，如果你只是想不求甚解地了解一下 Swift 标准库长什么样的话，你大可忽视掉这些标注，并跳到本文的下一节去。不过机会难得，结合 ABI 的一些话题，我还是想对这些标注到底都干了些什么进行一点说明。

### 什么是 Swift ABI，什么是 ABI 稳定

想要说清楚这几个标注的意义，我们需要从 ABI 说起。

API (Application Programming Interface) 的概念我们都很熟悉了，在很大程度上，API 稳定指的是源码级别的兼容，也就是：

* 新版本的编译器应该可以不做修改地编译旧版本的代码

在经过 Swift 3 的阵痛后，从 Swift 4 开始已经达成了源码兼容。不过，Swift Core Team 一直以来最为关心的是尽快做到 ABI 稳定。在运行时，Swift 二进制程序需要通过一套规则 (比如如何调用方法，在哪里能找到需要的类型信息，内存中的数据的布局是怎样等) 来和其他框架进行交互。这套规则定义就是 ABI (Application Binary Interface)。直观来说，ABI 稳定意味着这两件事情：

1. 去年的 app 可以使用今年的框架
2. 明年的 app 也可以使用今年的框架

ABI 稳定对于 Apple 自身非常重要，只有达到 ABI 稳定，Swift 才可能被大范围应用在 Apple 自己的软件框架中。对于我们第三方开发者来说，在没有 ABI 稳定的现在，只要我们在项目中使用了 Swift 代码，我们就需要把同样版本的 Swift 运行时和标准库等打包到最后的项目里。而一旦 ABI 稳定达成，就不再会有此限制，我们将可以直接使用系统自带的 Swift 运行时和标准库运行任意版本的 Swift 代码。

一旦宣称 ABI 稳定，这时候的 ABI 将成为 Swift 编译器规范，后续的编译器开发可以对规范进行添加，但是也必须确保不破坏已有的规范，这将会使这门语言的进化受到很大束缚 (其实有时候也未必是坏事)。这也是 Swift 团队一再推迟宣称 ABI 稳定的时间点的原因，因为必须确保 everything is correct and prepared。

#### Resilient 类型

ABI 一个很重要的方面就是计算和获取内存布局。当框架中的一个类型 `T` 的成员改变时 (比如添加一个新的存储变量)，它的实例在内存中的布局一般也会改变 (比如该成员的 offset 地址增加)。如果 app 里是直接通过 offset 地址来访问框架中类型的某个成员变量的话，当框架中该类型被改变时，除非 app 重新获取新的地址 (也就是重新编译和链接框架)，原来的代码将会错误地访问到其他变量或者甚至崩溃。这时候，`T` 就被叫做易碎 (fragile) 类型。

这让我们无法添加/删除/甚至对属性重新排序，但是框架必须要进化，这些事情难免发生。为了避免这种 fragile 的情况，我们在编译时就不能直接把属性偏移量写到 app 里，也就是说，我们不能将某个类型的内存布局直接暴露出去。在编译期间，编译器会把最新的偏移量信息写到和类型绑定的 metadata 中。在传递这个类型的时候，则使用非透明的布局 (Opaque Layout)，使用者要访问某个成员时，不再是直接通过偏移量直接进行内存地址读取，而是先访问存储了类型中各种信息的 metadata 并找到想要访问的成员的最新地址，然后再进行内存访问。这时候，我们在源码层级就可以任意地增删重排成员变量了。此时，就算换了新的编译器版本，只要 metadata 访问的算法和定义不变，旧版本的 app 依然可以使用新版本的框架。这种类型被称为弹性 (resilient) 类型。

&gt; 根绝类型不同，Type metadata 存储的内容也不尽相同。在[这里](https://github.com/apple/swift/blob/master/docs/ABI/TypeMetadata.rst)可以找到一些文档说明。

#### @_fixed_layout

有了上面的背景知识，我们就可以回到 `Bool.swift` 的源码了。Resilient 类型显然会带来性能上的额外开销，像是 `Bool` 这样的基础中的基础，我们显然是希望它越快越好。这里 `@_fixed_layout` 的作用是，告诉编译器这个 `struct` 的布局也应当被作为编译时考虑的部分。换句话说，这是开发者对编译器所做的保证，保证这个结构体中不会再增加或减少存储变量，也不会改变已有的变量的顺序。由此一来，外部在遇到这样的类型时，就可以放心大胆地直接用内存偏移量进行成员访问，而不必再经由 metadata 了。

#### @_inlineable 或 @_transparent

`@_fixed_layout` 解决了存储属性的性能和 ABI 问题。对于函数来说，最常见的优化方法大概就是将它内联 (inline) 了。inline 相当于将函数的具体实现完全暴露在接口中，编译期间，当 app 对框架中的某个方法进行调用时，编译器如果发现方法可以内联，就将具体实现“复制“过来，替换掉原有的方法调用。这可以减少模块间的方法调用的次数，加速运行时的性能。

`@_inlineable` 做的就是这件事情，为了在 Debug 时保留调用栈的信息，它只在 `-O` 的时候生效。它告诉编译器，在需要的时候可以将所声明的函数进行内联。`@_transparent` 和 `@_inlineable` 类似，不过它在 `-Onone` 时也会生效，并在编译时更早的阶段就被内联插入到目标位置。这样编译器就能在检查数据流 (比如 `if else`) 错误的时候找到可能出现的内联错误。

&gt; `@_transparent` 实际上是比 `@_inlineable` 更强的存在，所有的 `@_transparent` 声明其实也隐式包含了 `@_inlineable`。内联的声明非常有用，Swift 公开文档中还存在 `@inline(__always)` 和 `@inline(never)`，用来”强制“内联和非内联某个函数。

内联会给 ABI 稳定带来很多”陷阱“。最显而易见的是，被内联的方法的实现中的符号都会被外界”看到“。而很多时候这些符号并不是可用的，比如 `Bool` 的 `init` 中对 `self._value` 赋值的部分，`_value` 的 access permission 是 `internal`，这是无法被别的 module 看到的。

#### @_versioned

`@_versioned` 的主要目的就是解决上面的问题。在进行编译时，当遇到 `@_versioned` 的标签时，编译器将会“暂时”在内部将其作为 `public` 进行处理，这样，在 inline 的时候，即使某个 API 是 internal 或者 private 的，我们也依然可以对它进行调用了。

在 ABI 稳定方面，`@_versioned` 的意义也十分重要。我们可以安全地将某个以前就被标记为 `@_versioned` 的方法公开为 public，但是由于实际上这个方法会被外部 module inline 调用，所以我们不能轻易删除或者更改它的调用规则。

### 关于这几个私有 attribute 的总结
" link_users="{}"></textarea>
              <div class="markdown topic-body">
                <div class="xzl-topic-content" id="xzl-topic-content">
                    <p>在<a href="https://xiaozhuanlan.com/topic/3265840179" target="_blank">上一篇文章</a>中，我们搭建了 Swift 标准库的开发环境。从这篇文章开始，我们来尝试读读看 Swift 标准库中的一些实现。</p>
<p>当然从简单的开始，比如 <code>Bool</code> 类型就是一个很好的 starting point。<a href="https://github.com/apple/swift/blob/86fb3faaee5cf8759bfe329b996bfb224eaebc82/stdlib/public/core/Bool.swift" target="_blank">现在版本的 <code>Bool.swift</code></a> 代码，加上各种标注和注释，也不过区区 300 多行。你完全可以打开上面的链接，花几分钟阅读一下实现，然后再回到本文来看看我们能有什么样的发现。</p>
<h2 id="sectionattribute">标准库中常用的 Attribute</h2>
<p>很多时候，我们很快就会被开头的几行震慑住：</p>
<pre><code class="swift language-swift">@_fixed_layout
public struct Bool {
  @_versioned
  internal var _value: Builtin.Int1

  @_inlineable
  @_transparent
  public init() {
    let zero: Int8 = 0
    self._value = Builtin.trunc_Int8_Int1(zero._value)
  }</code></pre>
<p><code>@_fixed_layout</code>！<code>@_versioned</code>！<code>@_inlineable</code>！<code>@_transparent</code>！ 全是一些我们平常写 Swift 没有见过的私有标注...而且如果你完成了前一篇文章中的练习的话，你可以已经注意到了在其他源文件中也充斥着类似的标注。</p>
<p>这些标注大都和 Swift ABI 相关，它们为编译器最终完成 ABI 稳定提供了提示，同时也对性能进行优化。当然，如果你只是想不求甚解地了解一下 Swift 标准库长什么样的话，你大可忽视掉这些标注，并跳到本文的下一节去。不过机会难得，结合 ABI 的一些话题，我还是想对这些标注到底都干了些什么进行一点说明。</p>
<h3 id="sectionswiftabiabi">什么是 Swift ABI，什么是 ABI 稳定</h3>
<p>想要说清楚这几个标注的意义，我们需要从 ABI 说起。</p>
<p>API (Application Programming Interface) 的概念我们都很熟悉了，在很大程度上，API 稳定指的是源码级别的兼容，也就是：</p>
<ul>
<li>新版本的编译器应该可以不做修改地编译旧版本的代码</li>
</ul>
<p>在经过 Swift 3 的阵痛后，从 Swift 4 开始已经达成了源码兼容。不过，Swift Core Team 一直以来最为关心的是尽快做到 ABI 稳定。在运行时，Swift 二进制程序需要通过一套规则 (比如如何调用方法，在哪里能找到需要的类型信息，内存中的数据的布局是怎样等) 来和其他框架进行交互。这套规则定义就是 ABI (Application Binary Interface)。直观来说，ABI 稳定意味着这两件事情：</p>
<ol>
<li>去年的 app 可以使用今年的框架</li>
<li>明年的 app 也可以使用今年的框架</li>
</ol>
<p>ABI 稳定对于 Apple 自身非常重要，只有达到 ABI 稳定，Swift 才可能被大范围应用在 Apple 自己的软件框架中。对于我们第三方开发者来说，在没有 ABI 稳定的现在，只要我们在项目中使用了 Swift 代码，我们就需要把同样版本的 Swift 运行时和标准库等打包到最后的项目里。而一旦 ABI 稳定达成，就不再会有此限制，我们将可以直接使用系统自带的 Swift 运行时和标准库运行任意版本的 Swift 代码。</p>
<p>一旦宣称 ABI 稳定，这时候的 ABI 将成为 Swift 编译器规范，后续的编译器开发可以对规范进行添加，但是也必须确保不破坏已有的规范，这将会使这门语言的进化受到很大束缚 (其实有时候也未必是坏事)。这也是 Swift 团队一再推迟宣称 ABI 稳定的时间点的原因，因为必须确保 everything is correct and prepared。</p>
<h4 id="sectionresilient">Resilient 类型</h4>
<p>ABI 一个很重要的方面就是计算和获取内存布局。当框架中的一个类型 <code>T</code> 的成员改变时 (比如添加一个新的存储变量)，它的实例在内存中的布局一般也会改变 (比如该成员的 offset 地址增加)。如果 app 里是直接通过 offset 地址来访问框架中类型的某个成员变量的话，当框架中该类型被改变时，除非 app 重新获取新的地址 (也就是重新编译和链接框架)，原来的代码将会错误地访问到其他变量或者甚至崩溃。这时候，<code>T</code> 就被叫做易碎 (fragile) 类型。</p>
<p>这让我们无法添加/删除/甚至对属性重新排序，但是框架必须要进化，这些事情难免发生。为了避免这种 fragile 的情况，我们在编译时就不能直接把属性偏移量写到 app 里，也就是说，我们不能将某个类型的内存布局直接暴露出去。在编译期间，编译器会把最新的偏移量信息写到和类型绑定的 metadata 中。在传递这个类型的时候，则使用非透明的布局 (Opaque Layout)，使用者要访问某个成员时，不再是直接通过偏移量直接进行内存地址读取，而是先访问存储了类型中各种信息的 metadata 并找到想要访问的成员的最新地址，然后再进行内存访问。这时候，我们在源码层级就可以任意地增删重排成员变量了。此时，就算换了新的编译器版本，只要 metadata 访问的算法和定义不变，旧版本的 app 依然可以使用新版本的框架。这种类型被称为弹性 (resilient) 类型。</p>
<blockquote>
  <p>根绝类型不同，Type metadata 存储的内容也不尽相同。在<a href="https://github.com/apple/swift/blob/master/docs/ABI/TypeMetadata.rst" target="_blank">这里</a>可以找到一些文档说明。</p>
</blockquote>
<h4 id="section_fixed_layout">@_fixed_layout</h4>
<p>有了上面的背景知识，我们就可以回到 <code>Bool.swift</code> 的源码了。Resilient 类型显然会带来性能上的额外开销，像是 <code>Bool</code> 这样的基础中的基础，我们显然是希望它越快越好。这里 <code>@_fixed_layout</code> 的作用是，告诉编译器这个 <code>struct</code> 的布局也应当被作为编译时考虑的部分。换句话说，这是开发者对编译器所做的保证，保证这个结构体中不会再增加或减少存储变量，也不会改变已有的变量的顺序。由此一来，外部在遇到这样的类型时，就可以放心大胆地直接用内存偏移量进行成员访问，而不必再经由 metadata 了。</p>
<h4 id="section_inlineable_transparent">@_inlineable 或 @_transparent</h4>
<p><code>@_fixed_layout</code> 解决了存储属性的性能和 ABI 问题。对于函数来说，最常见的优化方法大概就是将它内联 (inline) 了。inline 相当于将函数的具体实现完全暴露在接口中，编译期间，当 app 对框架中的某个方法进行调用时，编译器如果发现方法可以内联，就将具体实现“复制“过来，替换掉原有的方法调用。这可以减少模块间的方法调用的次数，加速运行时的性能。</p>
<p><code>@_inlineable</code> 做的就是这件事情，为了在 Debug 时保留调用栈的信息，它只在 <code>-O</code> 的时候生效。它告诉编译器，在需要的时候可以将所声明的函数进行内联。<code>@_transparent</code> 和 <code>@_inlineable</code> 类似，不过它在 <code>-Onone</code> 时也会生效，并在编译时更早的阶段就被内联插入到目标位置。这样编译器就能在检查数据流 (比如 <code>if else</code>) 错误的时候找到可能出现的内联错误。</p>
<blockquote>
  <p><code>@_transparent</code> 实际上是比 <code>@_inlineable</code> 更强的存在，所有的 <code>@_transparent</code> 声明其实也隐式包含了 <code>@_inlineable</code>。内联的声明非常有用，Swift 公开文档中还存在 <code>@inline(__always)</code> 和 <code>@inline(never)</code>，用来”强制“内联和非内联某个函数。</p>
</blockquote>
<p>内联会给 ABI 稳定带来很多”陷阱“。最显而易见的是，被内联的方法的实现中的符号都会被外界”看到“。而很多时候这些符号并不是可用的，比如 <code>Bool</code> 的 <code>init</code> 中对 <code>self._value</code> 赋值的部分，<code>_value</code> 的 access permission 是 <code>internal</code>，这是无法被别的 module 看到的。</p>
<h4 id="section_versioned">@_versioned</h4>
<p><code>@_versioned</code> 的主要目的就是解决上面的问题。在进行编译时，当遇到 <code>@_versioned</code> 的标签时，编译器将会“暂时”在内部将其作为 <code>public</code> 进行处理，这样，在 inline 的时候，即使某个 API 是 internal 或者 private 的，我们也依然可以对它进行调用了。</p>
<p>在 ABI 稳定方面，<code>@_versioned</code> 的意义也十分重要。我们可以安全地将某个以前就被标记为 <code>@_versioned</code> 的方法公开为 public，但是由于实际上这个方法会被外部 module inline 调用，所以我们不能轻易删除或者更改它的调用规则。</p>
<h3 id="sectionattribute-1">关于这几个私有 attribute 的总结</h3>
                </div>
                    <div class="xzl-topic-body-content hidden_topic_body hidden" id="xzl-topic-body-content">
                        <p>在<a href="https://xiaozhuanlan.com/topic/3265840179" target="_blank">上一篇文章</a>中，我们搭建了 Swift 标准库的开发环境。从这篇文章开始，我们来尝试读读看 Swift 标准库中的一些实现。</p>
<p>当然从简单的开始，比如 <code>Bool</code> 类型就是一个很好的 starting point。<a href="https://github.com/apple/swift/blob/86fb3faaee5cf8759bfe329b996bfb224eaebc82/stdlib/public/core/Bool.swift" target="_blank">现在版本的 <code>Bool.swift</code></a> 代码，加上各种标注和注释，也不过区区 300 多行。你完全可以打开上面的链接，花几分钟阅读一下实现，然后再回到本文来看看我们能有什么样的发现。</p>
<h2 id="sectionattribute">标准库中常用的 Attribute</h2>
<p>很多时候，我们很快就会被开头的几行震慑住：</p>
<pre><code class="swift language-swift">@_fixed_layout
public struct Bool {
  @_versioned
  internal var _value: Builtin.Int1

  @_inlineable
  @_transparent
  public init() {
    let zero: Int8 = 0
    self._value = Builtin.trunc_Int8_Int1(zero._value)
  }</code></pre>
<p><code>@_fixed_layout</code>！<code>@_versioned</code>！<code>@_inlineable</code>！<code>@_transparent</code>！ 全是一些我们平常写 Swift 没有见过的私有标注...而且如果你完成了前一篇文章中的练习的话，你可以已经注意到了在其他源文件中也充斥着类似的标注。</p>
<p>这些标注大都和 Swift ABI 相关，它们为编译器最终完成 ABI 稳定提供了提示，同时也对性能进行优化。当然，如果你只是想不求甚解地了解一下 Swift 标准库长什么样的话，你大可忽视掉这些标注，并跳到本文的下一节去。不过机会难得，结合 ABI 的一些话题，我还是想对这些标注到底都干了些什么进行一点说明。</p>
<h3 id="sectionswiftabiabi">什么是 Swift ABI，什么是 ABI 稳定</h3>
<p>想要说清楚这几个标注的意义，我们需要从 ABI 说起。</p>
<p>API (Application Programming Interface) 的概念我们都很熟悉了，在很大程度上，API 稳定指的是源码级别的兼容，也就是：</p>
<ul>
<li>新版本的编译器应该可以不做修改地编译旧版本的代码</li>
</ul>
<p>在经过 Swift 3 的阵痛后，从 Swift 4 开始已经达成了源码兼容。不过，Swift Core Team 一直以来最为关心的是尽快做到 ABI 稳定。在运行时，Swift 二进制程序需要通过一套规则 (比如如何调用方法，在哪里能找到需要的类型信息，内存中的数据的布局是怎样等) 来和其他框架进行交互。这套规则定义就是 ABI (Application Binary Interface)。直观来说，ABI 稳定意味着这两件事情：</p>
<ol>
<li>去年的 app 可以使用今年的框架</li>
<li>明年的 app 也可以使用今年的框架</li>
</ol>
<p>ABI 稳定对于 Apple 自身非常重要，只有达到 ABI 稳定，Swift 才可能被大范围应用在 Apple 自己的软件框架中。对于我们第三方开发者来说，在没有 ABI 稳定的现在，只要我们在项目中使用了 Swift 代码，我们就需要把同样版本的 Swift 运行时和标准库等打包到最后的项目里。而一旦 ABI 稳定达成，就不再会有此限制，我们将可以直接使用系统自带的 Swift 运行时和标准库运行任意版本的 Swift 代码。</p>
<p>一旦宣称 ABI 稳定，这时候的 ABI 将成为 Swift 编译器规范，后续的编译器开发可以对规范进行添加，但是也必须确保不破坏已有的规范，这将会使这门语言的进化受到很大束缚 (其实有时候也未必是坏事)。这也是 Swift 团队一再推迟宣称 ABI 稳定的时间点的原因，因为必须确保 everything is correct and prepared。</p>
<h4 id="sectionresilient">Resilient 类型</h4>
<p>ABI 一个很重要的方面就是计算和获取内存布局。当框架中的一个类型 <code>T</code> 的成员改变时 (比如添加一个新的存储变量)，它的实例在内存中的布局一般也会改变 (比如该成员的 offset 地址增加)。如果 app 里是直接通过 offset 地址来访问框架中类型的某个成员变量的话，当框架中该类型被改变时，除非 app 重新获取新的地址 (也就是重新编译和链接框架)，原来的代码将会错误地访问到其他变量或者甚至崩溃。这时候，<code>T</code> 就被叫做易碎 (fragile) 类型。</p>
<p>这让我们无法添加/删除/甚至对属性重新排序，但是框架必须要进化，这些事情难免发生。为了避免这种 fragile 的情况，我们在编译时就不能直接把属性偏移量写到 app 里，也就是说，我们不能将某个类型的内存布局直接暴露出去。在编译期间，编译器会把最新的偏移量信息写到和类型绑定的 metadata 中。在传递这个类型的时候，则使用非透明的布局 (Opaque Layout)，使用者要访问某个成员时，不再是直接通过偏移量直接进行内存地址读取，而是先访问存储了类型中各种信息的 metadata 并找到想要访问的成员的最新地址，然后再进行内存访问。这时候，我们在源码层级就可以任意地增删重排成员变量了。此时，就算换了新的编译器版本，只要 metadata 访问的算法和定义不变，旧版本的 app 依然可以使用新版本的框架。这种类型被称为弹性 (resilient) 类型。</p>
<blockquote>
  <p>根绝类型不同，Type metadata 存储的内容也不尽相同。在<a href="https://github.com/apple/swift/blob/master/docs/ABI/TypeMetadata.rst" target="_blank">这里</a>可以找到一些文档说明。</p>
</blockquote>
<h4 id="section_fixed_layout">@_fixed_layout</h4>
<p>有了上面的背景知识，我们就可以回到 <code>Bool.swift</code> 的源码了。Resilient 类型显然会带来性能上的额外开销，像是 <code>Bool</code> 这样的基础中的基础，我们显然是希望它越快越好。这里 <code>@_fixed_layout</code> 的作用是，告诉编译器这个 <code>struct</code> 的布局也应当被作为编译时考虑的部分。换句话说，这是开发者对编译器所做的保证，保证这个结构体中不会再增加或减少存储变量，也不会改变已有的变量的顺序。由此一来，外部在遇到这样的类型时，就可以放心大胆地直接用内存偏移量进行成员访问，而不必再经由 metadata 了。</p>
<h4 id="section_inlineable_transparent">@_inlineable 或 @_transparent</h4>
<p><code>@_fixed_layout</code> 解决了存储属性的性能和 ABI 问题。对于函数来说，最常见的优化方法大概就是将它内联 (inline) 了。inline 相当于将函数的具体实现完全暴露在接口中，编译期间，当 app 对框架中的某个方法进行调用时，编译器如果发现方法可以内联，就将具体实现“复制“过来，替换掉原有的方法调用。这可以减少模块间的方法调用的次数，加速运行时的性能。</p>
<p><code>@_inlineable</code> 做的就是这件事情，为了在 Debug 时保留调用栈的信息，它只在 <code>-O</code> 的时候生效。它告诉编译器，在需要的时候可以将所声明的函数进行内联。<code>@_transparent</code> 和 <code>@_inlineable</code> 类似，不过它在 <code>-Onone</code> 时也会生效，并在编译时更早的阶段就被内联插入到目标位置。这样编译器就能在检查数据流 (比如 <code>if else</code>) 错误的时候找到可能出现的内联错误。</p>
<blockquote>
  <p><code>@_transparent</code> 实际上是比 <code>@_inlineable</code> 更强的存在，所有的 <code>@_transparent</code> 声明其实也隐式包含了 <code>@_inlineable</code>。内联的声明非常有用，Swift 公开文档中还存在 <code>@inline(__always)</code> 和 <code>@inline(never)</code>，用来”强制“内联和非内联某个函数。</p>
</blockquote>
<p>内联会给 ABI 稳定带来很多”陷阱“。最显而易见的是，被内联的方法的实现中的符号都会被外界”看到“。而很多时候这些符号并不是可用的，比如 <code>Bool</code> 的 <code>init</code> 中对 <code>self._value</code> 赋值的部分，<code>_value</code> 的 access permission 是 <code>internal</code>，这是无法被别的 module 看到的。</p>
<h4 id="section_versioned">@_versioned</h4>
<p><code>@_versioned</code> 的主要目的就是解决上面的问题。在进行编译时，当遇到 <code>@_versioned</code> 的标签时，编译器将会“暂时”在内部将其作为 <code>public</code> 进行处理，这样，在 inline 的时候，即使某个 API 是 internal 或者 private 的，我们也依然可以对它进行调用了。</p>
<p>在 ABI 稳定方面，<code>@_versioned</code> 的意义也十分重要。我们可以安全地将某个以前就被标记为 <code>@_versioned</code> 的方法公开为 public，但是由于实际上这个方法会被外部 module inline 调用，所以我们不能轻易删除或者更改它的调用规则。</p>
<h3 id="sectionattribute-1">关于这几个私有 attribute 的总结</h3>
                    </div>
                    <div class="xzl-topic-summary-content hidden_topic_body hidden" id="xzl-topic-summary-content">
                        <p>在<a href="https://xiaozhuanlan.com/topic/3265840179" target="_blank">上一篇文章</a>中，我们搭建了 Swift 标准库的开发环境。从这篇文章开始，我们来尝试读读看 Swift 标准库中的一些实现。</p>
<p>当然从简单的开始，比如 <code>Bool</code> 类型就是一个很好的 starting point。<a href="https://github.com/apple/swift/blob/86fb3faaee5cf8759bfe329b996bfb224eaebc82/stdlib/public/core/Bool.swift" target="_blank">现在版本的 <code>Bool.swift</code></a> 代码，加上各种标注和注释，也不过区区 300 多行。你完全可以打开上面的链接，花几分钟阅读一下实现，然后再回到本文来看看我们能有什么样的发现。</p>
<h2 id="sectionattribute">标准库中常用的 Attribute</h2>
<p>很多时候，我们很快就会被开头的几行震慑住：</p>
<pre><code class="swift language-swift">@_fixed_layout
public struct Bool {
  @_versioned
  internal var _value: Builtin.Int1

  @_inlineable
  @_transparent
  public init() {
    let zero: Int8 = 0
    self._value = Builtin.trunc_Int8_Int1(zero._value)
  }</code></pre>
<p><code>@_fixed_layout</code>！<code>@_versioned</code>！<code>@_inlineable</code>！<code>@_transparent</code>！ 全是一些我们平常写 Swift 没有见过的私有标注...而且如果你完成了前一篇文章中的练习的话，你可以已经注意到了在其他源文件中也充斥着类似的标注。</p>
<p>这些标注大都和 Swift ABI 相关，它们为编译器最终完成 ABI 稳定提供了提示，同时也对性能进行优化。当然，如果你只是想不求甚解地了解一下 Swift 标准库长什么样的话，你大可忽视掉这些标注，并跳到本文的下一节去。不过机会难得，结合 ABI 的一些话题，我还是想对这些标注到底都干了些什么进行一点说明。</p>
<h3 id="sectionswiftabiabi">什么是 Swift ABI，什么是 ABI 稳定</h3>
<p>想要说清楚这几个标注的意义，我们需要从 ABI 说起。</p>
<p>API (Application Programming Interface) 的概念我们都很熟悉了，在很大程度上，API 稳定指的是源码级别的兼容，也就是：</p>
<ul>
<li>新版本的编译器应该可以不做修改地编译旧版本的代码</li>
</ul>
<p>在经过 Swift 3 的阵痛后，从 Swift 4 开始已经达成了源码兼容。不过，Swift Core Team 一直以来最为关心的是尽快做到 ABI 稳定。在运行时，Swift 二进制程序需要通过一套规则 (比如如何调用方法，在哪里能找到需要的类型信息，内存中的数据的布局是怎样等) 来和其他框架进行交互。这套规则定义就是 ABI (Application Binary Interface)。直观来说，ABI 稳定意味着这两件事情：</p>
<ol>
<li>去年的 app 可以使用今年的框架</li>
<li>明年的 app 也可以使用今年的框架</li>
</ol>
<p>ABI 稳定对于 Apple 自身非常重要，只有达到 ABI 稳定，Swift 才可能被大范围应用在 Apple 自己的软件框架中。对于我们第三方开发者来说，在没有 ABI 稳定的现在，只要我们在项目中使用了 Swift 代码，我们就需要把同样版本的 Swift 运行时和标准库等打包到最后的项目里。而一旦 ABI 稳定达成，就不再会有此限制，我们将可以直接使用系统自带的 Swift 运行时和标准库运行任意版本的 Swift 代码。</p>
<p>一旦宣称 ABI 稳定，这时候的 ABI 将成为 Swift 编译器规范，后续的编译器开发可以对规范进行添加，但是也必须确保不破坏已有的规范，这将会使这门语言的进化受到很大束缚 (其实有时候也未必是坏事)。这也是 Swift 团队一再推迟宣称 ABI 稳定的时间点的原因，因为必须确保 everything is correct and prepared。</p>
<h4 id="sectionresilient">Resilient 类型</h4>
<p>ABI 一个很重要的方面就是计算和获取内存布局。当框架中的一个类型 <code>T</code> 的成员改变时 (比如添加一个新的存储变量)，它的实例在内存中的布局一般也会改变 (比如该成员的 offset 地址增加)。如果 app 里是直接通过 offset 地址来访问框架中类型的某个成员变量的话，当框架中该类型被改变时，除非 app 重新获取新的地址 (也就是重新编译和链接框架)，原来的代码将会错误地访问到其他变量或者甚至崩溃。这时候，<code>T</code> 就被叫做易碎 (fragile) 类型。</p>
<p>这让我们无法添加/删除/甚至对属性重新排序，但是框架必须要进化，这些事情难免发生。为了避免这种 fragile 的情况，我们在编译时就不能直接把属性偏移量写到 app 里，也就是说，我们不能将某个类型的内存布局直接暴露出去。在编译期间，编译器会把最新的偏移量信息写到和类型绑定的 metadata 中。在传递这个类型的时候，则使用非透明的布局 (Opaque Layout)，使用者要访问某个成员时，不再是直接通过偏移量直接进行内存地址读取，而是先访问存储了类型中各种信息的 metadata 并找到想要访问的成员的最新地址，然后再进行内存访问。这时候，我们在源码层级就可以任意地增删重排成员变量了。此时，就算换了新的编译器版本，只要 metadata 访问的算法和定义不变，旧版本的 app 依然可以使用新版本的框架。这种类型被称为弹性 (resilient) 类型。</p>
<blockquote>
  <p>根绝类型不同，Type metadata 存储的内容也不尽相同。在<a href="https://github.com/apple/swift/blob/master/docs/ABI/TypeMetadata.rst" target="_blank">这里</a>可以找到一些文档说明。</p>
</blockquote>
<h4 id="section_fixed_layout">@_fixed_layout</h4>
<p>有了上面的背景知识，我们就可以回到 <code>Bool.swift</code> 的源码了。Resilient 类型显然会带来性能上的额外开销，像是 <code>Bool</code> 这样的基础中的基础，我们显然是希望它越快越好。这里 <code>@_fixed_layout</code> 的作用是，告诉编译器这个 <code>struct</code> 的布局也应当被作为编译时考虑的部分。换句话说，这是开发者对编译器所做的保证，保证这个结构体中不会再增加或减少存储变量，也不会改变已有的变量的顺序。由此一来，外部在遇到这样的类型时，就可以放心大胆地直接用内存偏移量进行成员访问，而不必再经由 metadata 了。</p>
<h4 id="section_inlineable_transparent">@_inlineable 或 @_transparent</h4>
<p><code>@_fixed_layout</code> 解决了存储属性的性能和 ABI 问题。对于函数来说，最常见的优化方法大概就是将它内联 (inline) 了。inline 相当于将函数的具体实现完全暴露在接口中，编译期间，当 app 对框架中的某个方法进行调用时，编译器如果发现方法可以内联，就将具体实现“复制“过来，替换掉原有的方法调用。这可以减少模块间的方法调用的次数，加速运行时的性能。</p>
<p><code>@_inlineable</code> 做的就是这件事情，为了在 Debug 时保留调用栈的信息，它只在 <code>-O</code> 的时候生效。它告诉编译器，在需要的时候可以将所声明的函数进行内联。<code>@_transparent</code> 和 <code>@_inlineable</code> 类似，不过它在 <code>-Onone</code> 时也会生效，并在编译时更早的阶段就被内联插入到目标位置。这样编译器就能在检查数据流 (比如 <code>if else</code>) 错误的时候找到可能出现的内联错误。</p>
<blockquote>
  <p><code>@_transparent</code> 实际上是比 <code>@_inlineable</code> 更强的存在，所有的 <code>@_transparent</code> 声明其实也隐式包含了 <code>@_inlineable</code>。内联的声明非常有用，Swift 公开文档中还存在 <code>@inline(__always)</code> 和 <code>@inline(never)</code>，用来”强制“内联和非内联某个函数。</p>
</blockquote>
<p>内联会给 ABI 稳定带来很多”陷阱“。最显而易见的是，被内联的方法的实现中的符号都会被外界”看到“。而很多时候这些符号并不是可用的，比如 <code>Bool</code> 的 <code>init</code> 中对 <code>self._value</code> 赋值的部分，<code>_value</code> 的 access permission 是 <code>internal</code>，这是无法被别的 module 看到的。</p>
<h4 id="section_versioned">@_versioned</h4>
<p><code>@_versioned</code> 的主要目的就是解决上面的问题。在进行编译时，当遇到 <code>@_versioned</code> 的标签时，编译器将会“暂时”在内部将其作为 <code>public</code> 进行处理，这样，在 inline 的时候，即使某个 API 是 internal 或者 private 的，我们也依然可以对它进行调用了。</p>
<p>在 ABI 稳定方面，<code>@_versioned</code> 的意义也十分重要。我们可以安全地将某个以前就被标记为 <code>@_versioned</code> 的方法公开为 public，但是由于实际上这个方法会被外部 module inline 调用，所以我们不能轻易删除或者更改它的调用规则。</p>
<h3 id="sectionattribute-1">关于这几个私有 attribute 的总结</h3>
                    </div>
                <div class="carousel_collapsed_layer bg-gradient-snow"> </div>
                <div class="carousel_collapsed_layer trancent_block"> </div>
              </div>
                <div class="reward-partial reward-partial-mask">
      <div class="need-purchase-topic-partial">
  <div class="header-item">
    <div class="line-sperator">
      <div class="lock-img-div">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="19px" height="24px" viewBox="0 0 19 24" version="1.1" class="lock-img">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title></title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="&#20999;&#22270;" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-480.000000, -49.000000)" id="icon_lock">
            <g transform="translate(469.000000, 41.000000)">
                <g id="Group-2" transform="translate(11.000000, 8.000000)">
                    <rect id="Rectangle-38" fill="#818181" x="0" y="10" width="19" height="14" rx="2"></rect>
                    <rect id="Rectangle-2" stroke="#818181" stroke-width="2" x="4" y="1" width="11" height="15" rx="5.5"></rect>
                    <path d="M8.86710792,17.1396606 C8.35496722,17.3783376 8,17.8977153 8,18.5 C8,19.3284271 8.67157288,20 9.5,20 C10.3284271,20 11,19.3284271 11,18.5 C11,17.8971917 10.6444154,17.3774347 10.1315562,17.1390388 L10.6112061,14 L8.38214111,14 L8.86710792,17.1396606 Z" id="Combined-Shape" fill="#FFFFFF"></path>
                </g>
            </g>
        </g>
    </g>
</svg>

      </div>
    </div>
  </div>
  <div class="body-item">
    <div class="tip-one">剩余50%的内容订阅专栏后可查看</div>
    <div class="tip-two">直接购买阅读全文</div>
      <button class="button button--small purchase-topic-btn xzl-basic-btn xzl-btn-with-chrome xzl-base-color-normal-btn" data-topic-id="5096">
        <span class="button-label  xzl-default-state-btn ">
          9.9元
        </span>
      </button>
  </div>
  <div class="qrcode-for-purchase-topic"></div>
  
</div>
<div class="overlay wechat-pay-success-modal topic—order-payed-modal overlay--dark new-session-modal hidden">
  <div class="overlay-dialog overlay-dialog--animate js-overlayDialog"
  tabindex="-1">
    <div class="close">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16px" height="16px" viewBox="0 0 16 16" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title></title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-273.000000, -154.000000)" id="icon_close_2" fill="#818181">
            <path d="M281,160.59766 L274.691197,154.288858 C274.296436,153.894097 273.674377,153.899886 273.287131,154.287131 C272.897186,154.677077 272.900659,155.302999 273.288858,155.691197 L279.59766,162 L273.288858,168.308803 C272.894097,168.703564 272.899886,169.325623 273.287131,169.712869 C273.677077,170.102814 274.302999,170.099341 274.691197,169.711142 L281,163.40234 L287.308803,169.711142 C287.703564,170.105903 288.325623,170.100114 288.712869,169.712869 C289.102814,169.322923 289.099341,168.697001 288.711142,168.308803 L282.40234,162 L288.711142,155.691197 C289.105903,155.296436 289.100114,154.674377 288.712869,154.287131 C288.322923,153.897186 287.697001,153.900659 287.308803,154.288858 L281,160.59766 Z"></path>
        </g>
    </g>
</svg>

    </div>
    <div class="overlay-actions xzl-button-set">
      <img class="pay-success-logo"></img>
      <div class="header">
        <span class="tip">您成功购买文章</span>
      </div>
      <div class="line-sperator"></div>
      <div class="xzl-button-set share-topic-tip xzl-button-set--vertical">
        分享这篇超棒的文章
      </div>
      <div class="share-btns">
        <div class="share-to-weibo">
          <img class="share-to-weibo-logo"/>
          <span>微博分享</span>
        </div>
        <div class="share-to-wechat">
          <img class="share-to-wechat-logo"/>
          <span>微信扫一扫</span>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  window.user.purchaseTopicBtn()
</script>
    </div>

    <div class="topic-author-info " style="z-index: 2000">
      <div class="streamItem-card">
        <div class="user-info">
          <div class="zl-header">
            <a target="_blank" href="/u/onevcat">
              <img class="avatar" src="https://diycode.b0.upaiyun.com/photo/2018/1303552bf4de8fb5b9b395a80ecd5b51.jpeg" alt="1303552bf4de8fb5b9b395a80ecd5b51" />
</a>          </div>
          <div class="zl-body">
            <div class="zl-title"><a target="_blank" href="/u/onevcat">onevcat</a></div>
            <div class="zl-bio">王巍，iOS的职业开发者，旅居日本中，在LINE负责iOS项目开发</div>
          </div>
        </div>
      </div>
    </div>
    <div class="topic-show-zhuanlan topic-show-zhuanlan-before_subscribed">
      <div class="streamItem-card">
        <div class="zhuanlan">
          <div class="zl-header">
            <a href="/onevcat">
              <img class="avatar" src="https://diycode.b0.upaiyun.com/photo/2018/9021d4e3be07af500ab6cd26c6726517.jpg" alt="9021d4e3be07af500ab6cd26c6726517" />
</a>          </div>
          <div class="zl-body">
            <div class="zl-title"><a href="/onevcat">开发笔记簿</a></div>
            <div class="zl-bio">记录日常开发时遇到的问题和解决方案，同时也会收藏一些学习时记录的笔记，随想等。对于较长的文章，会在这边提前进行发布...</div>
          </div>
          <div class="zl-footer">
                <div class='xzl-button-set'>
                  <button class="button button--small zhuanlan-subscribe-btn link-btn xzl-btn-with-chrome xzl-red-color-normal-btn" data-is-replace="true" data-link-url="/onevcat/subscribe">
                    <span class="button-label  xzl-default-state-btn">
                      99元订阅
                    </span>
                  </button>
                </div>
          </div>
        </div>
      </div>
    </div>


          </div>
        </div>
      </section>
    </div>
  </article>
</div>
<div class='back-to-top'>
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="19px" height="11px" viewBox="0 0 19 11" version="1.1">
    <!-- Generator: Sketch 45.2 (43514) - http://www.bohemiancoding.com/sketch -->
    <title>top</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="A-首页-更改" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="B-文章详情-04" transform="translate(-1120.000000, -1149.000000)" stroke="#979797">
            <polyline id="top" transform="translate(1129.949747, 1158.949747) rotate(-315.000000) translate(-1129.949747, -1158.949747) " points="1123.62132 1165.27817 1123.62132 1152.62132 1123.62132 1152.62132 1136.27817 1152.62132"></polyline>
        </g>
    </g>
</svg>

</div>

<script type="text/javascript">
  $(".back-to-top").css({left: $(".xzl-home-containner").width() + $(".xzl-home-containner").offset().left + 50 + "px"})
  $(".back-to-top").click(function(){
    $("html, body").animate({
            scrollTop: 0
        }, 600);
  })
  $(window).scroll(function () {
      if ($(this).scrollTop() > 100) {
          $('.back-to-top').fadeIn();
      } else {
          $('.back-to-top').fadeOut();
      }
  });
</script>
<script type="text/javascript">
  
  setTimeout(function(){
    window.app.updateFrameHeight()
  }, 500)
  setTimeout(function(){
    window.app.fetch(window.location.href + "/visit", "get", {}, function(){}, false)
  }, 1500)


   var data = {}

    var contentTopic = document.getElementById("xzl-topic-content");

    contentTopic.innerHTML = (new window.Markdowner).getHtml();
    data["draft_html"] = $("#xzl-topic-content").html()

    var topicBody = document.getElementById("xzl-topic-body-content");
    topicBody.innerHTML = (new window.Markdowner).getBodyHtml();
    if(!!topicBody.innerHTML){
      data["body_html"] = $("#xzl-topic-body-content").html()
    }

    var summaryHtml = document.getElementById("xzl-topic-summary-content");
    summaryHtml.innerHTML = (new window.Markdowner).getSumarryHtml();
    data["summary_html"] = $("#xzl-topic-summary-content").html()
    $("pre code").each(function(){
      $(this).html("<ul><li><div class='code_line'>" + $(this).html().replace(/\n/g,"\n</div></li><li><div class='code_line'>") +"\n</div></li></ul>");
    });
    $('pre code').each(function(i, block) {
      hljs.highlightBlock(block);
    });
    //MathJax.Hub.Queue(["Typeset",MathJax.Hub, function(){
    if(!!$(".topic-body").data("enable-update-html")){
      data["update_token"] = $(".topic-body").data("update-token")
      $.ajax({
        url: $(".topic-body").data("url"),
        method: "put",
        data: data
      }).done(function(){
        summaryHtml.innerHTML = ""
        topicBody.innerHTML   = ""
      })
    }
    (new window.Markdowner).formatChartFromCode()
    //}]);
    $(".hidden_topic_body").remove()
</script>

    </div>
  </div>
    <div class="xzl-invite-card">
  <div class="share-logos">
    <div class="share-logo">
      <div class="share-tip"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="21px" height="17px" viewBox="0 0 21 17" version="1.1">
    <!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch -->
    <title></title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-468.000000, -514.000000)" id="icon_1_wechat" fill="#02BB00">
            <g transform="translate(468.000000, 514.000000)">
                <path d="M17,11 C16.4444444,11 16,10.5555556 16,10 C16,9.44444444 16.4444444,9 17,9 C17.5555556,9 18,9.44444444 18,10 C18,10.5277778 17.5555556,11 17,11 M12,11 C11.4444444,11 11,10.5555556 11,10 C11,9.44444444 11.4444444,9 12,9 C12.5555556,9 13,9.44444444 13,10 C13,10.5277778 12.5555556,11 12,11 M18.7527881,15.1010526 C20.1301115,14.1515789 21,12.7389474 21,11.1873684 C21,8.31578947 18.1003717,6 14.5,6 C10.8996283,6 8,8.31578947 8,11.1873684 C8,14.0589474 10.8996283,16.3747368 14.5,16.3747368 C15.2490706,16.3747368 15.9498141,16.2821053 16.6263941,16.0968421 C16.6747212,16.0736842 16.7472119,16.0736842 16.8197026,16.0736842 C16.9405204,16.0736842 17.0613383,16.12 17.1579926,16.1663158 L18.5836431,16.9536842 C18.6319703,16.9768421 18.6561338,17 18.704461,17 C18.8252788,17 18.9219331,16.9073684 18.9219331,16.7915789 C18.9219331,16.7452632 18.8977695,16.6989474 18.8977695,16.6294737 C18.8977695,16.6063158 18.704461,15.9810526 18.6078067,15.5873684 C18.5836431,15.5410526 18.5836431,15.4947368 18.5836431,15.4484211 C18.5594796,15.2863158 18.6319703,15.1705263 18.7527881,15.1010526" id="Shape-Copy"></path>
                <path d="M10,5.12844037 C9.45547362,5.12844037 9.02439024,4.70684873 9.02439024,4.17431193 C9.02439024,3.64177512 9.45547362,3.22018349 10,3.22018349 C10.5445264,3.22018349 10.9756098,3.64177512 10.9756098,4.17431193 C10.9756098,4.6846597 10.5445264,5.12844037 10,5.12844037 M5,5.12844037 C4.45547362,5.12844037 4.02439024,4.70684873 4.02439024,4.17431193 C4.02439024,3.64177512 4.45547362,3.22018349 5,3.22018349 C5.54452638,3.22018349 5.97560976,3.64177512 5.97560976,4.17431193 C5.97560976,4.6846597 5.54452638,5.12844037 5,5.12844037 M0,6.13508772 C0,7.98245614 1.00624025,9.64736842 2.62090484,10.7649123 C2.73790952,10.8561404 2.83151326,10.9929825 2.83151326,11.1754386 C2.83151326,11.2210526 2.80811232,11.2894737 2.80811232,11.3350877 C2.69110764,11.7912281 2.48049922,12.5438596 2.45709828,12.5666667 C2.43369735,12.6350877 2.41029641,12.6807018 2.41029641,12.7491228 C2.41029641,12.8859649 2.52730109,13 2.66770671,13 C2.71450858,13 2.76131045,12.977193 2.80811232,12.954386 L4.46957878,12.0192982 C4.58658346,11.9508772 4.72698908,11.9052632 4.8673947,11.9052632 C4.9375975,11.9052632 5.00780031,11.9052632 5.07800312,11.9280702 C5.85023401,12.1333333 6.69266771,12.2701754 7.5351014,12.2701754 L7.95631825,12.2701754 C7.7925117,11.7912281 7.69890796,11.2894737 7.69890796,10.7649123 C7.69890796,7.68596491 10.7878315,5.17719298 14.5787832,5.17719298 L15,5.17719298 C14.4617785,2.23508772 11.326053,0 7.55850234,0 C3.39313573,0 0,2.73684211 0,6.13508772 Z" id="Shape-Copy-2"></path>
            </g>
        </g>
    </g>
</svg>
<span>微信扫码</span></div>
      <div class="wechat-qrcode-img" data-url="https://xiaozhuanlan.com/topic/1046572983"></div>
    </div>
    <div class='line-speartor'></div>
    <div class="share-logo social-share-button" data-title="向大家推荐《简单又不简单的 Bool - Swift 标准库源码导读 (二)》
 https://xiaozhuanlan.com/topic/1046572983">

      <div class="share-tip" data-title="向大家推荐《简单又不简单的 Bool - Swift 标准库源码导读 (二)》
 https://xiaozhuanlan.com/topic/1046572983" ><a rel="nofollow " data-site="weibo" class="ssb-icon ssb-weibo" onclick="return SocialShareButton.share(this);" title="Share to Twitter" href=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="19px" viewBox="0 0 24 19" version="1.1">
    <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
    <title>icon_weibo_01@2x</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-786.000000, -75.000000)" id="icon_weibo_01" fill-rule="nonzero" fill="#F54E4C">
            <path d="M794.337934,85.2741341 C792.337079,85.5504873 790.899754,87.0989312 791.124877,88.7310747 C791.350722,90.3632182 793.155315,91.4628586 795.15617,91.1865054 C797.155582,90.9101522 798.595072,89.3617084 798.369227,87.7281218 C798.144104,86.0959783 796.338789,84.9970594 794.337934,85.2741341 Z M793.754201,89.8855528 C793.050691,89.9829619 792.417171,89.5969333 792.337079,89.0225804 C792.25843,88.4496706 792.763514,87.9056228 793.467024,87.8074921 C794.169813,87.7108046 794.804054,88.0968332 794.884146,88.6711861 C794.962795,89.2448174 794.456989,89.7881437 793.754201,89.8855528 Z M795.547971,88.0391093 C795.252858,88.1141504 794.963517,87.9792208 794.903628,87.7382234 C794.842297,87.4972261 795.032064,87.2417978 795.327177,87.1674783 C795.622291,87.0931588 795.910189,87.2273669 795.97152,87.4683642 C796.033574,87.7093615 795.841642,87.9655113 795.547971,88.0391093 Z M804.723908,82.5676044 C804.827811,82.6116188 804.936765,82.6325437 805.043554,82.6325437 C805.3632,82.6325437 805.668416,82.4442195 805.80118,82.1303457 C805.954149,81.7695713 806.031355,81.3849858 806.031355,80.989577 C806.031355,79.3740291 804.717414,78.0593671 803.101866,78.0593671 C802.707179,78.0593671 802.323315,78.1365729 801.961098,78.2895412 C801.542599,78.4670422 801.347059,78.9497584 801.523839,79.3675352 C801.70134,79.7860335 802.184056,79.9822948 802.602554,79.8055153 C802.760574,79.7391329 802.928695,79.7052201 803.101866,79.7052201 C803.809706,79.7052201 804.386223,80.281016 804.386223,80.989577 C804.386223,81.1641918 804.353032,81.3323127 804.286649,81.4896104 C804.109148,81.9073872 804.30541,82.3908249 804.723908,82.5676044 Z M802.808196,83.780528 C802.889009,83.5489108 802.969101,83.3201798 802.969101,83.3201798 C804.409313,80.5559262 800.696222,79.6547116 798.566932,80.8293932 C796.438363,82.0055178 797.465848,80.0154861 797.465848,80.0154861 C797.817964,76.3810445 793.997363,77.9893769 793.997363,77.9893769 C785.124477,82.9651778 786.025691,87.8962426 786.025691,87.8962426 C786.025691,90.6099878 790.279943,93.640493 795.64538,93.640493 C802.753358,93.640493 806.806298,89.4850932 806.102066,86.3968641 C805.817055,85.1500277 804.336436,84.0814138 802.808196,83.780528 Z M794.588311,92.2291435 C789.934321,92.2291435 788.359902,89.8083471 788.359902,88.0585911 C788.359902,85.2864004 792.032585,83.2386448 795.490247,83.2386448 C798.947188,83.2386448 801.411277,84.7077183 801.975528,86.6342537 C802.811082,89.4850932 799.16726,92.2291435 794.588311,92.2291435 Z M803.101866,75 C802.594617,75 802.088812,75.0642178 801.601045,75.1904889 C801.161621,75.3037721 800.896813,75.7525755 801.010096,76.1927203 C801.124822,76.6321435 801.572904,76.8969519 802.012327,76.7836688 C802.365886,76.6913105 802.732433,76.6458529 803.102588,76.6458529 C805.496687,76.6458529 807.44559,78.5947564 807.44559,80.9888555 C807.44559,81.5025982 807.356118,82.0047962 807.182947,82.4802969 C807.027092,82.9067323 807.246443,83.3800684 807.672878,83.5352014 C807.765958,83.5691142 807.861202,83.5857098 807.955004,83.5857098 C808.290524,83.5857098 808.606562,83.3779037 808.727783,83.0445481 C808.967337,82.3872171 809.09,81.6952518 809.09,80.9881339 C809.089279,77.6870479 806.403674,75 803.101866,75 Z"></path>
        </g>
    </g>
</svg>
<span>新浪微博</span></a></div>
      <div class="share-tip" data-title="向大家推荐《简单又不简单的 Bool - Swift 标准库源码导读 (二)》
 https://xiaozhuanlan.com/topic/1046572983" ><a rel="nofollow " data-site="twitter" class="ssb-icon ssb-twitter" onclick="return SocialShareButton.share(this);" title="Share to Twitter" href=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="21px" height="18px" viewBox="0 0 21 18" version="1.1">
    <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
    <title>icon_twitter@2x</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="切图" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g transform="translate(-722.000000, -74.000000)" id="icon_twitter" fill-rule="nonzero" fill="#1296DB">
            <g transform="translate(722.000000, 74.000000)">
                <path d="M14.2831702,0.00104702329 C15.9524708,-0.0287932359 16.8416087,0.582932296 17.6886425,1.3587793 C18.4093643,1.29661208 19.3430829,0.891281729 19.8953886,0.612772555 C20.0737115,0.513304984 20.2520344,0.416324117 20.4303574,0.316856546 C20.1158155,1.17227761 19.6873452,1.83871032 19.0334945,2.34848158 C18.8873688,2.4603826 18.7437198,2.61207062 18.5604435,2.68418461 L18.5604435,2.69413138 C19.4941621,2.68418464 20.2668947,2.26144748 21,2.03018537 L21,2.04013212 C20.6161104,2.65434433 20.0935252,3.27601663 19.5387428,3.72362069 C19.3133624,3.90266232 19.0904588,4.08170392 18.8650784,4.26074555 C18.877462,5.25542121 18.8502182,6.20284978 18.6644651,7.03837733 C17.5895743,11.8948813 14.7388843,15.1897444 10.2263239,16.6021838 C8.60655738,17.1094684 5.98620119,17.3158636 4.13114753,16.8533394 C3.20981246,16.624564 2.37763887,16.3659483 1.59747612,16.0227852 C1.16405237,15.8313102 0.762825805,15.624915 0.378936204,15.3911662 L0,15.1599041 C0.418563521,15.1723376 0.908951532,15.2892119 1.37704919,15.2121246 C1.8005661,15.1424973 2.2166529,15.1623908 2.60549592,15.0753567 C3.58131855,14.8615014 4.44568934,14.5780188 5.19117821,14.1403616 C5.55277746,13.928993 6.10012974,13.6778374 6.35770728,13.3719746 C5.87474938,13.3794347 5.43389551,13.2675337 5.07477296,13.1407125 C3.68038684,12.6458614 2.8705036,11.7382198 2.34296497,10.3730275 C2.76648189,10.4177879 3.98254511,10.5296889 4.26736644,10.2884801 C3.73487439,10.2586398 3.22467272,9.95029034 2.85812006,9.72151494 C1.73617171,9.01778191 0.82226678,7.83660455 0.829696899,6.01883477 C0.978299323,6.08846205 1.12442505,6.15808937 1.27055078,6.22771665 C1.55289539,6.34707774 1.83771672,6.41173164 2.17454889,6.47887227 C2.31572119,6.50871253 2.60054253,6.59325997 2.76400519,6.53109275 L2.74171483,6.53109275 C2.52624131,6.27745045 2.17207219,6.10835559 1.95412195,5.83730646 C1.23587688,4.93961166 0.559735827,3.55701251 0.988206164,1.91331097 C1.09718127,1.4955472 1.26807408,1.1275172 1.4513504,0.786840798 C1.45878052,0.789327478 1.46621064,0.794300863 1.47116406,0.796787543 C1.55537211,0.973342466 1.74112513,1.10265032 1.86000708,1.24936496 C2.22903644,1.70691576 2.67979716,2.11721947 3.14294139,2.48027611 C4.71565044,3.71864731 6.13232692,4.4770875 8.4059441,5.03907926 C8.98301686,5.18082054 9.64925109,5.29023485 10.3402524,5.29272153 C10.1470692,4.72575642 10.2089869,3.81065479 10.360066,3.2610965 C10.7439556,1.88347071 11.5761293,0.891281729 12.7996226,0.356643575 C13.0918741,0.229822424 13.4163227,0.137814918 13.7556316,0.0632142461 C13.9314778,0.0433207319 14.107324,0.0209405375 14.2831702,0.00104702329" id="Shape"></path>
            </g>
        </g>
    </g>
</svg>
<span>Twitter</span></a></div>
    </div>
  </div>
  <div class="popover-arrow down">
  </div>
</div>

<script type="text/javascript">
  $(".topic-share-btn-item").hover(function(){
  $(".xzl-invite-card").css({"top": $(".topic-share-btn").offset().top - 200, "left": $(".topic-share-btn").offset().left - 175})
    $(".xzl-invite-card").addClass("hovering-logo")
    $(".xzl-invite-card").show()
  })
  $(".xzl-invite-card").hover(function(){
    $(".xzl-invite-card").addClass("hovering-card")
    $(".xzl-invite-card").show()
  })

  var checkoutFoucs = function(){
    if(!$(".xzl-invite-card").hasClass("hovering-logo")){
      if(!$(".xzl-invite-card").hasClass("hovering-card")){
        $(".xzl-invite-card").hide()
      }
    }
  }

  $(".xzl-invite-card").mouseleave(function(){
    $(".xzl-invite-card").removeClass("hovering-card")
    setTimeout(checkoutFoucs, 500)
  })

  $(".topic-share-btn-item").mouseleave(function(){
    $(".xzl-invite-card").removeClass("hovering-logo")
    setTimeout(checkoutFoucs, 500)
  })
   $(".wechat-qrcode-img").qrcode({
    render: "canvas",
    text: $(".wechat-qrcode-img").data("url"),
    height: 70,
    width: 70,
  })

</script>
  
</body>

<script type="text/javascript">
  $(document).ready(function(){
    $("abbr.timeago").timeago()
    window.Photo.initUserAvatarDropzone()
    window.Photo.browseUpload(".user-avatar-edit")
    window.Photo.initPhotoDropzone("zhuanlan-logo", ".zhuanlan-logo-img")
    window.Photo.browsePhotoUpload("zhuanlan-logo")

    $(".buttonSwitch button").click(function(){
      if($(this).parent().hasClass("uneditable")){
        return
      }
      var siblings = $(this).siblings()
      siblings.each(function(index){
        $(siblings[index]).removeClass("selected")
      })
      $(this).addClass("selected")
    })
    Turbolinks.start()
  })
  window.user.init()
</script>

  <script type="text/javascript">
    // $("html, body").animate({
    //     scrollTop: 0
    // }, 600);
    var resize  = function(){
      var width = $(window).width()
      if (width > 730){
         $(".xzl-topic-item .topic-body .topic-cover-wrapper, .xzl-topic-item .topic-body .topic-cover-wrapper .topic-cover-div").css("height", 180 + "px")
      }else{  
        var height = 180*(width - 40)/670
        $(".xzl-topic-item .topic-body .topic-cover-wrapper, .xzl-topic-item .topic-body .topic-cover-wrapper .topic-cover-div").css("height", height + "px")
      }

      if(width > 1340){
        $(".topic-editor-dropzone.dz-clickable, .navbar.navbar-default, .cmmde_title, .topic-cover-dropzone.dz-clickable").css({"width": "670px"})
      }else{
        var maxWidth = ($(window).width() - 80) /2 
        $(".topic-editor-dropzone.dz-clickable, .navbar.navbar-default, .cmmde_title, .topic-cover-dropzone.dz-clickable").css({"width": maxWidth + "px"})
      }
    }
    window.onresize = resize;
    resize()
    window.followUserHover = function(){
      $(".btn-follow-user").unbind("hover")
      $(".btn-follow-user").unbind("mouseleave")
      $(".btn-follow-user.followed").hover(function(){
        if($(this).hasClass("followed")){
          $(this).find("span").text("取消关注")
        }
      })
      $(".btn-follow-user.followed").mouseleave(function(){
        $(this).find("span").text("已关注")
      })
    }
    window.followUserHover()

  </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-102672567-1', 'auto');
    ga('send', 'pageview');

  </script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e7fbc901596776745c59d839ad5b5ef7";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  
</html>

